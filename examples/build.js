(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lib = require('../lib');

var _lib2 = _interopRequireDefault(_lib);

var WIDTH = 257;
var HEIGHT = 257;
var CELL_SIZE = 2;

var map = new _lib2['default']({
    width: WIDTH,
    height: HEIGHT
});

window.map = map;

var canvas = document.createElement('canvas');
canvas.classList.add('Surface', 'js-surface');
canvas.setAttribute('width', WIDTH * CELL_SIZE);
canvas.setAttribute('height', HEIGHT * CELL_SIZE);

var ctx = canvas.getContext('2d');

function lerp(value) {
    return 'rgba( 255, 255, 255, ' + value / 255 + ' )';
}

for (var x = 0; x < WIDTH; x++) {
    for (var y = 0; y < HEIGHT; y++) {
        ctx.fillStyle = lerp(map.get(x, y));
        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
    }
}

document.body.appendChild(canvas);

},{"../lib":2}],2:[function(require,module,exports){
"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var DisplacementMap = (function () {
    function DisplacementMap(opts) {
        var _this = this;

        _classCallCheck(this, DisplacementMap);

        this.generateSquare = function (x, y, size) {
            var mid = size / 2;
            var avg = _this.getAvgCorner(x, y, x + size, y + size);
            _this.set(x + mid, y + mid, avg + _this.variance() * size / (_this.width - 1));
        };

        this.generateDiamond = function (x, y, size) {
            var mid = size / 2;

            var setCell = (function (xx, yy) {
                var avg = this.getAvgPoint(xx, yy, mid);
                //console.log( 'setting diamond point', xx, yy, avg, 'for', x, y, size )
                this.set(xx, yy, avg + this.variance() * size / (this.width - 1));
            }).bind(_this);

            setCell(x + mid, y);
            setCell(x + mid, y + size);
            setCell(x, y + mid);
            setCell(x + size, y + mid);
        };

        var options = opts || {};

        // Assign defaults or use opts
        // @TODO check power of 2 + 1 values
        this.width = options.width || 65;
        this.height = options.height || 65;

        this.buffer = new ArrayBuffer(this.width * this.height);
        this.array = new Uint8Array(this.buffer);

        // Seed corners
        this.array[this.to1d(0, 0)] = 255;
        this.array[this.to1d(0, this.height - 1)] = 255;
        this.array[this.to1d(this.width - 1, 0)] = 255;
        this.array[this.to1d(this.width - 1, this.height - 1)] = 127.5;

        this.generate(1);

        console.log(this.array);
    }

    DisplacementMap.prototype.get = function get(x, y) {
        return this.array[this.to1d(this.wrap(x), this.wrap(y))];
    };

    DisplacementMap.prototype.set = function set(x, y, value) {
        this.array[this.to1d(this.wrap(x), this.wrap(y))] = this.clamp255(value);
    };

    /*-----------------------------------------------------------*
     *
     *  Generation methods
     *
     *-----------------------------------------------------------*/

    /**
     * Returns +-127
     */

    DisplacementMap.prototype.variance = function variance() {
        return -127 + Math.random() * 255;
    };

    /**
     * Averages (mean) all values passed as args
     */

    DisplacementMap.prototype.getAvg = function getAvg() {
        return Array.prototype.reduce.call(arguments, function (prev, num) {
            return prev + num;
        }) / arguments.length;
    };

    /**
     * Grabs the average of each edge point
     */

    DisplacementMap.prototype.getAvgEdge = function getAvgEdge(x1, y1, x2, y2) {
        var size = ~ ~(x2 - x1) / 2;
        return this.getAvg(this.get(x1 + size, y1), this.get(x1, y1 + size), this.get(x2, y1 + size), this.get(x1 + size, y2));
    };

    /**
     * Grabs the average from each corner point
     */

    DisplacementMap.prototype.getAvgCorner = function getAvgCorner(x1, y1, x2, y2) {
        return this.getAvg(this.get(x1, y1), this.get(x2, y1), this.get(x1, y2), this.get(x2, y2));
    };

    /**
     * Get average from a central point
     */

    DisplacementMap.prototype.getAvgPoint = function getAvgPoint(x, y, size) {
        return this.getAvg(this.get(x, y - size), this.get(x + size, y), this.get(x - size, y), this.get(x, y + size));
    };

    /**
     * @param cb <function> iterator to call
     * @param step <float> 0...1
     */

    DisplacementMap.prototype.iterate = function iterate(cb, step) {
        var size = (this.width - 1) * step;
        for (var x = 0; x < this.width - 1; x += size) {
            for (var y = 0; y < this.height - 1; y += size) {
                cb(x, y, size);
            }
        }
    };

    DisplacementMap.prototype.generate = function generate(step) {
        var dist = (this.width - 1) * step;

        this.iterate(this.generateSquare, step);
        this.iterate(this.generateDiamond, step);

        if (dist > 2) {
            this.generate(step / 2);
        }
    };

    /*-----------------------------------------------------------*
     *
     *  Helpers
     *
     *-----------------------------------------------------------*/

    /**
     * Converts from 2d to 1d
     */

    DisplacementMap.prototype.to1d = function to1d(x, y) {
        return y * this.width + x;
    };

    /**
     * Wraps 0...255 i.e. 257 becomes 1 (because 0 is important)
     */

    DisplacementMap.prototype.wrap255 = function wrap255(value) {
        return value & 255;
    };

    /**
     * Wraps 0...this.width - 1
     */
    // wrap( value ) {
    //     return value & ( this.width - 1 )
    // }

    DisplacementMap.prototype.wrap = function wrap(num) {
        var min = 0;
        var max = this.width - 1;

        if (num > max) {
            return num % max;
        }

        if (num < min) {
            return max - (min - num) % (max - min);
        }

        return num;
    };

    /**
     * Clamps to 0...255
     */

    DisplacementMap.prototype.clamp255 = function clamp255(value) {
        return Math.max(Math.min(value, 255), 0);
    };

    /**
     * Clamps 0....this.width - 1
     */

    DisplacementMap.prototype.clamp = function clamp(value) {
        return Math.max(Math.min(value, this.width - 1), 0);
    };

    return DisplacementMap;
})();

exports["default"] = DisplacementMap;
module.exports = exports["default"];

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvbWF0dHN0eWxlcy9wcm9qZWN0cy9wcm9jZWR1cmFsL2Rpc3BsYWNlbWVudC1tYXAvZXhhbXBsZXMvc3JjLmpzIiwiL1VzZXJzL21hdHRzdHlsZXMvcHJvamVjdHMvcHJvY2VkdXJhbC9kaXNwbGFjZW1lbnQtbWFwL2xpYi9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7bUJDQ2dCLFFBQVE7Ozs7QUFFeEIsSUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFBO0FBQ2pCLElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQTtBQUNsQixJQUFNLFNBQVMsR0FBRyxDQUFDLENBQUE7O0FBRW5CLElBQUksR0FBRyxHQUFHLHFCQUFRO0FBQ2QsU0FBSyxFQUFFLEtBQUs7QUFDWixVQUFNLEVBQUUsTUFBTTtDQUNqQixDQUFDLENBQUE7O0FBRUYsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUE7O0FBRWhCLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUUsUUFBUSxDQUFFLENBQUE7QUFDL0MsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUUsU0FBUyxFQUFFLFlBQVksQ0FBRSxDQUFBO0FBQy9DLE1BQU0sQ0FBQyxZQUFZLENBQUUsT0FBTyxFQUFFLEtBQUssR0FBRyxTQUFTLENBQUUsQ0FBQTtBQUNqRCxNQUFNLENBQUMsWUFBWSxDQUFFLFFBQVEsRUFBRSxNQUFNLEdBQUcsU0FBUyxDQUFFLENBQUE7O0FBRW5ELElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUUsSUFBSSxDQUFFLENBQUE7O0FBRW5DLFNBQVMsSUFBSSxDQUFFLEtBQUssRUFBRztBQUNuQixXQUFPLHVCQUF1QixHQUFLLEtBQUssR0FBRyxHQUFJLEFBQUUsR0FBRyxJQUFJLENBQUE7Q0FDM0Q7O0FBR0QsS0FBTSxJQUFJ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QUMsRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzFILENBQUM7Ozs7OztBQU1GLG1CQUFlLENBQUMsU0FBUyxDQUFDLFlBQVksR0FBRyxTQUFTLFlBQVksQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUU7QUFDM0UsZUFBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDOUYsQ0FBQzs7Ozs7O0FBTUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLFNBQVMsV0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFO0FBQ3JFLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztLQUNsSCxDQUFDOzs7Ozs7O0FBT0YsbUJBQWUsQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLFNBQVMsT0FBTyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUU7QUFDM0QsWUFBSSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQSxHQUFJLElBQUksQ0FBQztBQUNuQyxhQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRTtBQUMzQyxpQkFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxJQUFJLEVBQUU7QUFDNUMsa0JBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO2FBQ2xCO1NBQ0o7S0FDSixDQUFDOztBQUVGLG1CQUFlLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxTQUFTLFFBQVEsQ0FBQyxJQUFJLEVBQUU7QUFDekQsWUFBSSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQSxHQUFJLElBQUksQ0FBQzs7QUFFbkMsWUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3hDLFlBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxJQUFJLENBQUMsQ0FBQzs7QUFFekMsWUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO0FBQ1YsZ0JBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzNCO0tBQ0osQ0FBQzs7Ozs7Ozs7Ozs7O0FBWUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUU7QUFDakQsZUFBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7S0FDN0IsQ0FBQzs7Ozs7O0FBTUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLFNBQVMsT0FBTyxDQUFDLEtBQUssRUFBRTtBQUN4RCxlQUFPLEtBQUssR0FBRyxHQUFHLENBQUM7S0FDdEIsQ0FBQzs7Ozs7Ozs7O0FBU0YsbUJBQWUsQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsSUFBSSxDQUFDLEdBQUcsRUFBRTtBQUNoRCxZQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDWixZQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQzs7QUFFekIsWUFBSSxHQUFHLEdBQUcsR0FBRyxFQUFFO0FBQ1gsbUJBQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQztTQUNwQjs7QUFFRCxZQUFJLEdBQUcsR0FBRyxHQUFHLEVBQUU7QUFDWCxtQkFBTyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFBLElBQUssR0FBRyxHQUFHLEdBQUcsQ0FBQSxBQUFDLENBQUM7U0FDMUM7O0FBRUQsZUFBTyxHQUFHLENBQUM7S0FDZCxDQUFDOzs7Ozs7QUFNRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUcsU0FBUyxRQUFRLENBQUMsS0FBSyxFQUFFO0FBQzFELGVBQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUM1QyxDQUFDOzs7Ozs7QUFNRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsU0FBUyxLQUFLLENBQUMsS0FBSyxFQUFFO0FBQ3BELGVBQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQ3ZELENBQUM7O0FBRUYsV0FBTyxlQUFlLENBQUM7Q0FDMUIsQ0FBQSxFQUFHLENBQUM7O0FBRUwsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLGVBQWUsQ0FBQztBQUNyQyxNQUFNLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJcbmltcG9ydCBNYXAgZnJvbSAnLi4vbGliJ1xuXG5jb25zdCBXSURUSCA9IDI1N1xuY29uc3QgSEVJR0hUID0gMjU3XG5jb25zdCBDRUxMX1NJWkUgPSAyXG5cbmxldCBtYXAgPSBuZXcgTWFwKHtcbiAgICB3aWR0aDogV0lEVEgsXG4gICAgaGVpZ2h0OiBIRUlHSFRcbn0pXG5cbndpbmRvdy5tYXAgPSBtYXBcblxubGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdjYW52YXMnIClcbmNhbnZhcy5jbGFzc0xpc3QuYWRkKCAnU3VyZmFjZScsICdqcy1zdXJmYWNlJyApXG5jYW52YXMuc2V0QXR0cmlidXRlKCAnd2lkdGgnLCBXSURUSCAqIENFTExfU0laRSApXG5jYW52YXMuc2V0QXR0cmlidXRlKCAnaGVpZ2h0JywgSEVJR0hUICogQ0VMTF9TSVpFIClcblxubGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCAnMmQnIClcblxuZnVuY3Rpb24gbGVycCggdmFsdWUgKSB7XG4gICAgcmV0dXJuICdyZ2JhKCAyNTUsIDI1NSwgMjU1LCAnICsgKCB2YWx1ZSAvIDB4ZmYgKSArICcgKSdcbn1cblxuXG5mb3IgKCBsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrICkge1xuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KysgKSB7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBsZXJwKCBtYXAuZ2V0KCB4LCB5ICkgKVxuICAgICAgICBjdHguZmlsbFJlY3QoIHggKiBDRUxMX1NJWkUsIHkgKiBDRUxMX1NJWkUsIENFTExfU0laRSwgQ0VMTF9TSVpFIClcbiAgICB9XG59XG5cblxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggY2FudmFzIClcbiIsIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG52YXIgRGlzcGxhY2VtZW50TWFwID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXNwbGFjZW1lbnRNYXAob3B0cykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEaXNwbGFjZW1lbnRNYXApO1xuXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVTcXVhcmUgPSBmdW5jdGlvbiAoeCwgeSwgc2l6ZSkge1xuICAgICAgICAgICAgdmFyIG1pZCA9IHNpemUgLyAyO1xuICAgICAgICAgICAgdmFyIGF2ZyA9IF90aGlzLmdldEF2Z0Nvcm5lcih4LCB5LCB4ICsgc2l6ZSwgeSArIHNpemUpO1xuICAgICAgICAgICAgX3RoaXMuc2V0KHggKyBtaWQsIHkgKyBtaWQsIGF2ZyArIF90aGlzLnZhcmlhbmNlKCkgKiBzaXplIC8gKF90aGlzLndpZHRoIC0gMSkpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVEaWFtb25kID0gZnVuY3Rpb24gKHgsIHksIHNpemUpIHtcbiAgICAgICAgICAgIHZhciBtaWQgPSBzaXplIC8gMjtcblxuICAgICAgICAgICAgdmFyIHNldENlbGwgPSAoZnVuY3Rpb24gKHh4LCB5eSkge1xuICAgICAgICAgICAgICAgIHZhciBhdmcgPSB0aGlzLmdldEF2Z1BvaW50KHh4LCB5eSwgbWlkKTtcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCAnc2V0dGluZyBkaWFtb25kIHBvaW50JywgeHgsIHl5LCBhdmcsICdmb3InLCB4LCB5LCBzaXplIClcbiAgICAgICAgICAgICAgICB0aGlzLnNldCh4eCwgeXksIGF2ZyArIHRoaXMudmFyaWFuY2UoKSAqIHNpemUgLyAodGhpcy53aWR0aCAtIDEpKTtcbiAgICAgICAgICAgIH0pLmJpbmQoX3RoaXMpO1xuXG4gICAgICAgICAgICBzZXRDZWxsKHggKyBtaWQsIHkpO1xuICAgICAgICAgICAgc2V0Q2VsbCh4ICsgbWlkLCB5ICsgc2l6ZSk7XG4gICAgICAgICAgICBzZXRDZWxsKHgsIHkgKyBtaWQpO1xuICAgICAgICAgICAgc2V0Q2VsbCh4ICsgc2l6ZSwgeSArIG1pZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG9wdGlvbnMgPSBvcHRzIHx8IHt9O1xuXG4gICAgICAgIC8vIEFzc2lnbiBkZWZhdWx0cyBvciB1c2Ugb3B0c1xuICAgICAgICAvLyBAVE9ETyBjaGVjayBwb3dlciBvZiAyICsgMSB2YWx1ZXNcbiAgICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgNjU7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNjU7XG5cbiAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5hcnJheSA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyKTtcblxuICAgICAgICAvLyBTZWVkIGNvcm5lcnNcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQoMCwgMCldID0gMjU1O1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCgwLCB0aGlzLmhlaWdodCAtIDEpXSA9IDI1NTtcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQodGhpcy53aWR0aCAtIDEsIDApXSA9IDI1NTtcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQodGhpcy53aWR0aCAtIDEsIHRoaXMuaGVpZ2h0IC0gMSldID0gMTI3LjU7XG5cbiAgICAgICAgdGhpcy5nZW5lcmF0ZSgxKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFycmF5KTtcbiAgICB9XG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldCh4LCB5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndyYXAoeCksIHRoaXMud3JhcCh5KSldO1xuICAgIH07XG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIHNldCh4LCB5LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndyYXAoeCksIHRoaXMud3JhcCh5KSldID0gdGhpcy5jbGFtcDI1NSh2YWx1ZSk7XG4gICAgfTtcblxuICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qXG4gICAgICpcbiAgICAgKiAgR2VuZXJhdGlvbiBtZXRob2RzXG4gICAgICpcbiAgICAgKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgKy0xMjdcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUudmFyaWFuY2UgPSBmdW5jdGlvbiB2YXJpYW5jZSgpIHtcbiAgICAgICAgcmV0dXJuIC0xMjcgKyBNYXRoLnJhbmRvbSgpICogMjU1O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBdmVyYWdlcyAobWVhbikgYWxsIHZhbHVlcyBwYXNzZWQgYXMgYXJnc1xuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZXRBdmcgPSBmdW5jdGlvbiBnZXRBdmcoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUucmVkdWNlLmNhbGwoYXJndW1lbnRzLCBmdW5jdGlvbiAocHJldiwgbnVtKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJldiArIG51bTtcbiAgICAgICAgfSkgLyBhcmd1bWVudHMubGVuZ3RoO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBvZiBlYWNoIGVkZ2UgcG9pbnRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0QXZnRWRnZSA9IGZ1bmN0aW9uIGdldEF2Z0VkZ2UoeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgdmFyIHNpemUgPSB+IH4oeDIgLSB4MSkgLyAyO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEgKyBzaXplLCB5MSksIHRoaXMuZ2V0KHgxLCB5MSArIHNpemUpLCB0aGlzLmdldCh4MiwgeTEgKyBzaXplKSwgdGhpcy5nZXQoeDEgKyBzaXplLCB5MikpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBmcm9tIGVhY2ggY29ybmVyIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z0Nvcm5lciA9IGZ1bmN0aW9uIGdldEF2Z0Nvcm5lcih4MSwgeTEsIHgyLCB5Mikge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEsIHkxKSwgdGhpcy5nZXQoeDIsIHkxKSwgdGhpcy5nZXQoeDEsIHkyKSwgdGhpcy5nZXQoeDIsIHkyKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldCBhdmVyYWdlIGZyb20gYSBjZW50cmFsIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z1BvaW50ID0gZnVuY3Rpb24gZ2V0QXZnUG9pbnQoeCwgeSwgc2l6ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeCwgeSAtIHNpemUpLCB0aGlzLmdldCh4ICsgc2l6ZSwgeSksIHRoaXMuZ2V0KHggLSBzaXplLCB5KSwgdGhpcy5nZXQoeCwgeSArIHNpemUpKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNiIDxmdW5jdGlvbj4gaXRlcmF0b3IgdG8gY2FsbFxuICAgICAqIEBwYXJhbSBzdGVwIDxmbG9hdD4gMC4uLjFcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuaXRlcmF0ZSA9IGZ1bmN0aW9uIGl0ZXJhdGUoY2IsIHN0ZXApIHtcbiAgICAgICAgdmFyIHNpemUgPSAodGhpcy53aWR0aCAtIDEpICogc3RlcDtcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB0aGlzLndpZHRoIC0gMTsgeCArPSBzaXplKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0IC0gMTsgeSArPSBzaXplKSB7XG4gICAgICAgICAgICAgICAgY2IoeCwgeSwgc2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uIGdlbmVyYXRlKHN0ZXApIHtcbiAgICAgICAgdmFyIGRpc3QgPSAodGhpcy53aWR0aCAtIDEpICogc3RlcDtcblxuICAgICAgICB0aGlzLml0ZXJhdGUodGhpcy5nZW5lcmF0ZVNxdWFyZSwgc3RlcCk7XG4gICAgICAgIHRoaXMuaXRlcmF0ZSh0aGlzLmdlbmVyYXRlRGlhbW9uZCwgc3RlcCk7XG5cbiAgICAgICAgaWYgKGRpc3QgPiAyKSB7XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlKHN0ZXAgLyAyKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKlxuICAgICAqXG4gICAgICogIEhlbHBlcnNcbiAgICAgKlxuICAgICAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgZnJvbSAyZCB0byAxZFxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS50bzFkID0gZnVuY3Rpb24gdG8xZCh4LCB5KSB7XG4gICAgICAgIHJldHVybiB5ICogdGhpcy53aWR0aCArIHg7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFdyYXBzIDAuLi4yNTUgaS5lLiAyNTcgYmVjb21lcyAxIChiZWNhdXNlIDAgaXMgaW1wb3J0YW50KVxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS53cmFwMjU1ID0gZnVuY3Rpb24gd3JhcDI1NSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWUgJiAyNTU7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFdyYXBzIDAuLi50aGlzLndpZHRoIC0gMVxuICAgICAqL1xuICAgIC8vIHdyYXAoIHZhbHVlICkge1xuICAgIC8vICAgICByZXR1cm4gdmFsdWUgJiAoIHRoaXMud2lkdGggLSAxIClcbiAgICAvLyB9XG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLndyYXAgPSBmdW5jdGlvbiB3cmFwKG51bSkge1xuICAgICAgICB2YXIgbWluID0gMDtcbiAgICAgICAgdmFyIG1heCA9IHRoaXMud2lkdGggLSAxO1xuXG4gICAgICAgIGlmIChudW0gPiBtYXgpIHtcbiAgICAgICAgICAgIHJldHVybiBudW0gJSBtYXg7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobnVtIDwgbWluKSB7XG4gICAgICAgICAgICByZXR1cm4gbWF4IC0gKG1pbiAtIG51bSkgJSAobWF4IC0gbWluKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudW07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENsYW1wcyB0byAwLi4uMjU1XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmNsYW1wMjU1ID0gZnVuY3Rpb24gY2xhbXAyNTUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KE1hdGgubWluKHZhbHVlLCAyNTUpLCAwKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xhbXBzIDAuLi4udGhpcy53aWR0aCAtIDFcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuY2xhbXAgPSBmdW5jdGlvbiBjbGFtcCh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoTWF0aC5taW4odmFsdWUsIHRoaXMud2lkdGggLSAxKSwgMCk7XG4gICAgfTtcblxuICAgIHJldHVybiBEaXNwbGFjZW1lbnRNYXA7XG59KSgpO1xuXG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IERpc3BsYWNlbWVudE1hcDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07Il19
