(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lib = require('../lib');

var _lib2 = _interopRequireDefault(_lib);

var WIDTH = 257;
var HEIGHT = 257;
var CELL_SIZE = 3;

var map = new _lib2['default']({
    width: WIDTH,
    height: HEIGHT
});

window.map = map;

var canvas = document.createElement('canvas');
canvas.classList.add('Surface', 'js-surface');
canvas.setAttribute('width', WIDTH * CELL_SIZE);
canvas.setAttribute('height', HEIGHT * CELL_SIZE);

var ctx = canvas.getContext('2d');

function lerp(value) {
    return 'rgba( 255, 255, 255, ' + value / 255 + ' )';
}

for (var x = 1; x < WIDTH - 1; x++) {
    for (var y = 1; y < HEIGHT - 1; y++) {
        ctx.fillStyle = lerp(map.get(x, y));
        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
    }
}

document.body.appendChild(canvas);

},{"../lib":2}],2:[function(require,module,exports){
"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var DisplacementMap = (function () {
    function DisplacementMap(opts) {
        var _this = this;

        _classCallCheck(this, DisplacementMap);

        this.generateSquare = function (x, y, size) {
            var mid = size / 2;
            var avg = _this.getAvgCorner(x, y, x + size, y + size);
            _this.set(x + mid, y + mid, avg + _this.getMidpointDisplacement(size));
        };

        this.generateDiamond = function (x, y, size) {
            var mid = size / 2;

            var setCell = (function (xx, yy) {
                var avg = this.getAvgPoint(xx, yy, mid);
                //console.log( 'setting diamond point', xx, yy, avg, 'for', x, y, size )
                this.set(xx, yy, avg + this.getMidpointDisplacement(size));
            }).bind(_this);

            setCell(x + mid, y);
            setCell(x + mid, y + size);
            setCell(x, y + mid);
            setCell(x + size, y + mid);
        };

        var options = opts || {};

        // Assign defaults or use opts
        // @TODO check power of 2 + 1 values
        this.width = options.width || 65;
        this.height = options.height || 65;

        this.smoothness = 1;

        this.buffer = new ArrayBuffer(this.width * this.height);
        this.array = new Uint8Array(this.buffer);

        // Seed corners
        this.array[this.to1d(0, 0)] = 128;
        this.array[this.to1d(0, this.height - 1)] = 128;
        this.array[this.to1d(this.width - 1, 0)] = 128;
        this.array[this.to1d(this.width - 1, this.height - 1)] = 128;

        this.generate(1);

        console.log(this.array);
    }

    DisplacementMap.prototype.get = function get(x, y) {
        return this.array[this.to1d(this.wrap(x), this.wrap(y))];
    };

    DisplacementMap.prototype.set = function set(x, y, value) {
        this.array[this.to1d(this.wrap(x), this.wrap(y))] = this.clamp255(value);
    };

    /*-----------------------------------------------------------*
     *
     *  Generation methods
     *
     *-----------------------------------------------------------*/

    /**
     * Returns +-127
     */

    DisplacementMap.prototype.variance = function variance() {
        return -128 + Math.random() * 255;
    };

    /**
     * Total variance * smoothness * step
     * Step decreases with each fold to produce a better result
     */

    DisplacementMap.prototype.getMidpointDisplacement = function getMidpointDisplacement(size) {
        return this.variance() * this.smoothness * (size / (this.width - 1));
    };

    /**
     * Averages (mean) all values passed as args
     */

    DisplacementMap.prototype.getAvg = function getAvg() {
        return Array.prototype.reduce.call(arguments, function (prev, num) {
            return prev + num;
        }) / arguments.length;
    };

    /**
     * Grabs the average of each edge point
     */

    DisplacementMap.prototype.getAvgEdge = function getAvgEdge(x1, y1, x2, y2) {
        var size = ~ ~(x2 - x1) / 2;
        return this.getAvg(this.get(x1 + size, y1), this.get(x1, y1 + size), this.get(x2, y1 + size), this.get(x1 + size, y2));
    };

    /**
     * Grabs the average from each corner point
     */

    DisplacementMap.prototype.getAvgCorner = function getAvgCorner(x1, y1, x2, y2) {
        return this.getAvg(this.get(x1, y1), this.get(x2, y1), this.get(x1, y2), this.get(x2, y2));
    };

    /**
     * Get average from a central point
     */

    DisplacementMap.prototype.getAvgPoint = function getAvgPoint(x, y, size) {
        return this.getAvg(this.get(x, y - size), this.get(x + size, y), this.get(x - size, y), this.get(x, y + size));
    };

    /**
     * @param cb <function> iterator to call
     * @param step <float> 0...1
     */

    DisplacementMap.prototype.iterate = function iterate(cb, step) {
        var size = (this.width - 1) * step;
        for (var x = 0; x < this.width - 1; x += size) {
            for (var y = 0; y < this.height - 1; y += size) {
                cb(x, y, size);
            }
        }
    };

    DisplacementMap.prototype.generate = function generate(step) {
        var dist = (this.width - 1) * step;

        this.iterate(this.generateSquare, step);
        this.iterate(this.generateDiamond, step);

        if (dist > 2) {
            this.generate(step / 2);
        }
    };

    /*-----------------------------------------------------------*
     *
     *  Helpers
     *
     *-----------------------------------------------------------*/

    /**
     * Converts from 2d to 1d
     */

    DisplacementMap.prototype.to1d = function to1d(x, y) {
        return y * this.width + x;
    };

    /**
     * Wraps 0...255 i.e. 257 becomes 1 (because 0 is important)
     */

    DisplacementMap.prototype.wrap255 = function wrap255(value) {
        return value & 255;
    };

    /**
     * Wraps 0...this.width - 1
     */
    // wrap( value ) {
    //     return value & ( this.width - 1 )
    // }

    DisplacementMap.prototype.wrap = function wrap(num) {
        var min = 0;
        var max = this.width - 1;

        if (num > max) {
            return num % max;
        }

        if (num < min) {
            return max - (min - num) % (max - min);
        }

        return num;
    };

    /**
     * Clamps to 0...255
     */

    DisplacementMap.prototype.clamp255 = function clamp255(value) {
        return Math.max(Math.min(value, 255), 0);
    };

    /**
     * Clamps 0....this.width - 1
     */

    DisplacementMap.prototype.clamp = function clamp(value) {
        return Math.max(Math.min(value, this.width - 1), 0);
    };

    return DisplacementMap;
})();

exports["default"] = DisplacementMap;
module.exports = exports["default"];

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvbWF0dHN0eWxlcy9wcm9qZWN0cy9teXByb2plY3RzL3Byb2NlZHVyYWwvZGlzcGxhY2VtZW50LW1hcC9leGFtcGxlcy9zcmMuanMiLCIvVXNlcnMvbWF0dHN0eWxlcy9wcm9qZWN0cy9teXByb2plY3RzL3Byb2NlZHVyYWwvZGlzcGxhY2VtZW50LW1hcC9saWIvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O21CQ0NnQixRQUFROzs7O0FBRXhCLElBQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQTtBQUNqQixJQUFNLE1BQU0sR0FBRyxHQUFHLENBQUE7QUFDbEIsSUFBTSxTQUFTLEdBQUcsQ0FBQyxDQUFBOztBQUVuQixJQUFJLEdBQUcsR0FBRyxxQkFBUTtBQUNkLFNBQUssRUFBRSxLQUFLO0FBQ1osVUFBTSxFQUFFLE1BQU07Q0FDakIsQ0FBQyxDQUFBOztBQUVGLE1BQU0sQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFBOztBQUVoQixJQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFFLFFBQVEsQ0FBRSxDQUFBO0FBQy9DLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFFLFNBQVMsRUFBRSxZQUFZLENBQUUsQ0FBQTtBQUMvQyxNQUFNLENBQUMsWUFBWSxDQUFFLE9BQU8sRUFBRSxLQUFLLEdBQUcsU0FBUyxDQUFFLENBQUE7QUFDakQsTUFBTSxDQUFDLFlBQVksQ0FBRSxRQUFRLEVBQUUsTUFBTSxHQUFHLFNBQVMsQ0FBRSxDQUFBOztBQUVuRCxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFFLElBQUksQ0FBRSxDQUFBOztBQUVuQyxTQUFTLElBQUksQ0FBRSxLQUFLLEVBQUc7QUFDbkIsV0FBTyx1QkFBdUIsR0FBSyxLQUFLLEdBQUcsR0FBSSxBQUFFLEdBQUcsSUFBSSxDQUFB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QyxTQUFTLENBQUMsVUFBVSxHQUFHLFNBQVMsVUFBVSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtBQUN2RSxZQUFJLElBQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQSxBQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzVCLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUMxSCxDQUFDOzs7Ozs7QUFNRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsU0FBUyxZQUFZLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO0FBQzNFLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzlGLENBQUM7Ozs7OztBQU1GLG1CQUFlLENBQUMsU0FBUyxDQUFDLFdBQVcsR0FBRyxTQUFTLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtBQUNyRSxlQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUks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QUFDLEtBQUssRUFBRTtBQUNwRCxlQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUN2RCxDQUFDOztBQUVGLFdBQU8sZUFBZSxDQUFDO0NBQzFCLENBQUEsRUFBRyxDQUFDOztBQUVMLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxlQUFlLENBQUM7QUFDckMsTUFBTSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG5pbXBvcnQgTWFwIGZyb20gJy4uL2xpYidcblxuY29uc3QgV0lEVEggPSAyNTdcbmNvbnN0IEhFSUdIVCA9IDI1N1xuY29uc3QgQ0VMTF9TSVpFID0gM1xuXG5sZXQgbWFwID0gbmV3IE1hcCh7XG4gICAgd2lkdGg6IFdJRFRILFxuICAgIGhlaWdodDogSEVJR0hUXG59KVxuXG53aW5kb3cubWFwID0gbWFwXG5cbmxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnY2FudmFzJyApXG5jYW52YXMuY2xhc3NMaXN0LmFkZCggJ1N1cmZhY2UnLCAnanMtc3VyZmFjZScgKVxuY2FudmFzLnNldEF0dHJpYnV0ZSggJ3dpZHRoJywgV0lEVEggKiBDRUxMX1NJWkUgKVxuY2FudmFzLnNldEF0dHJpYnV0ZSggJ2hlaWdodCcsIEhFSUdIVCAqIENFTExfU0laRSApXG5cbmxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApXG5cbmZ1bmN0aW9uIGxlcnAoIHZhbHVlICkge1xuICAgIHJldHVybiAncmdiYSggMjU1LCAyNTUsIDI1NSwgJyArICggdmFsdWUgLyAweGZmICkgKyAnICknXG59XG5cblxuZm9yICggbGV0IHggPSAxOyB4IDwgV0lEVEggLSAxOyB4KysgKSB7XG4gICAgZm9yIChsZXQgeSA9IDE7IHkgPCBIRUlHSFQgLSAxOyB5KysgKSB7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBsZXJwKCBtYXAuZ2V0KCB4LCB5ICkgKVxuICAgICAgICBjdHguZmlsbFJlY3QoIHggKiBDRUxMX1NJWkUsIHkgKiBDRUxMX1NJWkUsIENFTExfU0laRSwgQ0VMTF9TSVpFIClcbiAgICB9XG59XG5cblxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggY2FudmFzIClcbiIsIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG52YXIgRGlzcGxhY2VtZW50TWFwID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXNwbGFjZW1lbnRNYXAob3B0cykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEaXNwbGFjZW1lbnRNYXApO1xuXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVTcXVhcmUgPSBmdW5jdGlvbiAoeCwgeSwgc2l6ZSkge1xuICAgICAgICAgICAgdmFyIG1pZCA9IHNpemUgLyAyO1xuICAgICAgICAgICAgdmFyIGF2ZyA9IF90aGlzLmdldEF2Z0Nvcm5lcih4LCB5LCB4ICsgc2l6ZSwgeSArIHNpemUpO1xuICAgICAgICAgICAgX3RoaXMuc2V0KHggKyBtaWQsIHkgKyBtaWQsIGF2ZyArIF90aGlzLmdldE1pZHBvaW50RGlzcGxhY2VtZW50KHNpemUpKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmdlbmVyYXRlRGlhbW9uZCA9IGZ1bmN0aW9uICh4LCB5LCBzaXplKSB7XG4gICAgICAgICAgICB2YXIgbWlkID0gc2l6ZSAvIDI7XG5cbiAgICAgICAgICAgIHZhciBzZXRDZWxsID0gKGZ1bmN0aW9uICh4eCwgeXkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXZnID0gdGhpcy5nZXRBdmdQb2ludCh4eCwgeXksIG1pZCk7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyggJ3NldHRpbmcgZGlhbW9uZCBwb2ludCcsIHh4LCB5eSwgYXZnLCAnZm9yJywgeCwgeSwgc2l6ZSApXG4gICAgICAgICAgICAgICAgdGhpcy5zZXQoeHgsIHl5LCBhdmcgKyB0aGlzLmdldE1pZHBvaW50RGlzcGxhY2VtZW50KHNpemUpKTtcbiAgICAgICAgICAgIH0pLmJpbmQoX3RoaXMpO1xuXG4gICAgICAgICAgICBzZXRDZWxsKHggKyBtaWQsIHkpO1xuICAgICAgICAgICAgc2V0Q2VsbCh4ICsgbWlkLCB5ICsgc2l6ZSk7XG4gICAgICAgICAgICBzZXRDZWxsKHgsIHkgKyBtaWQpO1xuICAgICAgICAgICAgc2V0Q2VsbCh4ICsgc2l6ZSwgeSArIG1pZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG9wdGlvbnMgPSBvcHRzIHx8IHt9O1xuXG4gICAgICAgIC8vIEFzc2lnbiBkZWZhdWx0cyBvciB1c2Ugb3B0c1xuICAgICAgICAvLyBAVE9ETyBjaGVjayBwb3dlciBvZiAyICsgMSB2YWx1ZXNcbiAgICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgNjU7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNjU7XG5cbiAgICAgICAgdGhpcy5zbW9vdGhuZXNzID0gMTtcblxuICAgICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcih0aGlzLndpZHRoICogdGhpcy5oZWlnaHQpO1xuICAgICAgICB0aGlzLmFycmF5ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIpO1xuXG4gICAgICAgIC8vIFNlZWQgY29ybmVyc1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCgwLCAwKV0gPSAxMjg7XG4gICAgICAgIHRoaXMuYXJyYXlbdGhpcy50bzFkKDAsIHRoaXMuaGVpZ2h0IC0gMSldID0gMTI4O1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndpZHRoIC0gMSwgMCldID0gMTI4O1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndpZHRoIC0gMSwgdGhpcy5oZWlnaHQgLSAxKV0gPSAxMjg7XG5cbiAgICAgICAgdGhpcy5nZW5lcmF0ZSgxKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFycmF5KTtcbiAgICB9XG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldCh4LCB5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndyYXAoeCksIHRoaXMud3JhcCh5KSldO1xuICAgIH07XG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIHNldCh4LCB5LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndyYXAoeCksIHRoaXMud3JhcCh5KSldID0gdGhpcy5jbGFtcDI1NSh2YWx1ZSk7XG4gICAgfTtcblxuICAgIC8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qXG4gICAgICpcbiAgICAgKiAgR2VuZXJhdGlvbiBtZXRob2RzXG4gICAgICpcbiAgICAgKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgKy0xMjdcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUudmFyaWFuY2UgPSBmdW5jdGlvbiB2YXJpYW5jZSgpIHtcbiAgICAgICAgcmV0dXJuIC0xMjggKyBNYXRoLnJhbmRvbSgpICogMjU1O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUb3RhbCB2YXJpYW5jZSAqIHNtb290aG5lc3MgKiBzdGVwXG4gICAgICogU3RlcCBkZWNyZWFzZXMgd2l0aCBlYWNoIGZvbGQgdG8gcHJvZHVjZSBhIGJldHRlciByZXN1bHRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0TWlkcG9pbnREaXNwbGFjZW1lbnQgPSBmdW5jdGlvbiBnZXRNaWRwb2ludERpc3BsYWNlbWVudChzaXplKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhcmlhbmNlKCkgKiB0aGlzLnNtb290aG5lc3MgKiAoc2l6ZSAvICh0aGlzLndpZHRoIC0gMSkpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBdmVyYWdlcyAobWVhbikgYWxsIHZhbHVlcyBwYXNzZWQgYXMgYXJnc1xuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZXRBdmcgPSBmdW5jdGlvbiBnZXRBdmcoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUucmVkdWNlLmNhbGwoYXJndW1lbnRzLCBmdW5jdGlvbiAocHJldiwgbnVtKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJldiArIG51bTtcbiAgICAgICAgfSkgLyBhcmd1bWVudHMubGVuZ3RoO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBvZiBlYWNoIGVkZ2UgcG9pbnRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0QXZnRWRnZSA9IGZ1bmN0aW9uIGdldEF2Z0VkZ2UoeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgdmFyIHNpemUgPSB+IH4oeDIgLSB4MSkgLyAyO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEgKyBzaXplLCB5MSksIHRoaXMuZ2V0KHgxLCB5MSArIHNpemUpLCB0aGlzLmdldCh4MiwgeTEgKyBzaXplKSwgdGhpcy5nZXQoeDEgKyBzaXplLCB5MikpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBmcm9tIGVhY2ggY29ybmVyIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z0Nvcm5lciA9IGZ1bmN0aW9uIGdldEF2Z0Nvcm5lcih4MSwgeTEsIHgyLCB5Mikge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEsIHkxKSwgdGhpcy5nZXQoeDIsIHkxKSwgdGhpcy5nZXQoeDEsIHkyKSwgdGhpcy5nZXQoeDIsIHkyKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldCBhdmVyYWdlIGZyb20gYSBjZW50cmFsIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z1BvaW50ID0gZnVuY3Rpb24gZ2V0QXZnUG9pbnQoeCwgeSwgc2l6ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeCwgeSAtIHNpemUpLCB0aGlzLmdldCh4ICsgc2l6ZSwgeSksIHRoaXMuZ2V0KHggLSBzaXplLCB5KSwgdGhpcy5nZXQoeCwgeSArIHNpemUpKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNiIDxmdW5jdGlvbj4gaXRlcmF0b3IgdG8gY2FsbFxuICAgICAqIEBwYXJhbSBzdGVwIDxmbG9hdD4gMC4uLjFcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuaXRlcmF0ZSA9IGZ1bmN0aW9uIGl0ZXJhdGUoY2IsIHN0ZXApIHtcbiAgICAgICAgdmFyIHNpemUgPSAodGhpcy53aWR0aCAtIDEpICogc3RlcDtcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB0aGlzLndpZHRoIC0gMTsgeCArPSBzaXplKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0IC0gMTsgeSArPSBzaXplKSB7XG4gICAgICAgICAgICAgICAgY2IoeCwgeSwgc2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uIGdlbmVyYXRlKHN0ZXApIHtcbiAgICAgICAgdmFyIGRpc3QgPSAodGhpcy53aWR0aCAtIDEpICogc3RlcDtcblxuICAgICAgICB0aGlzLml0ZXJhdGUodGhpcy5nZW5lcmF0ZVNxdWFyZSwgc3RlcCk7XG4gICAgICAgIHRoaXMuaXRlcmF0ZSh0aGlzLmdlbmVyYXRlRGlhbW9uZCwgc3RlcCk7XG5cbiAgICAgICAgaWYgKGRpc3QgPiAyKSB7XG4gICAgICAgICAgICB0aGlzLmdlbmVyYXRlKHN0ZXAgLyAyKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKlxuICAgICAqXG4gICAgICogIEhlbHBlcnNcbiAgICAgKlxuICAgICAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgZnJvbSAyZCB0byAxZFxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS50bzFkID0gZnVuY3Rpb24gdG8xZCh4LCB5KSB7XG4gICAgICAgIHJldHVybiB5ICogdGhpcy53aWR0aCArIHg7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFdyYXBzIDAuLi4yNTUgaS5lLiAyNTcgYmVjb21lcyAxIChiZWNhdXNlIDAgaXMgaW1wb3J0YW50KVxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS53cmFwMjU1ID0gZnVuY3Rpb24gd3JhcDI1NSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWUgJiAyNTU7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFdyYXBzIDAuLi50aGlzLndpZHRoIC0gMVxuICAgICAqL1xuICAgIC8vIHdyYXAoIHZhbHVlICkge1xuICAgIC8vICAgICByZXR1cm4gdmFsdWUgJiAoIHRoaXMud2lkdGggLSAxIClcbiAgICAvLyB9XG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLndyYXAgPSBmdW5jdGlvbiB3cmFwKG51bSkge1xuICAgICAgICB2YXIgbWluID0gMDtcbiAgICAgICAgdmFyIG1heCA9IHRoaXMud2lkdGggLSAxO1xuXG4gICAgICAgIGlmIChudW0gPiBtYXgpIHtcbiAgICAgICAgICAgIHJldHVybiBudW0gJSBtYXg7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobnVtIDwgbWluKSB7XG4gICAgICAgICAgICByZXR1cm4gbWF4IC0gKG1pbiAtIG51bSkgJSAobWF4IC0gbWluKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBudW07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENsYW1wcyB0byAwLi4uMjU1XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmNsYW1wMjU1ID0gZnVuY3Rpb24gY2xhbXAyNTUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KE1hdGgubWluKHZhbHVlLCAyNTUpLCAwKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xhbXBzIDAuLi4udGhpcy53aWR0aCAtIDFcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuY2xhbXAgPSBmdW5jdGlvbiBjbGFtcCh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoTWF0aC5taW4odmFsdWUsIHRoaXMud2lkdGggLSAxKSwgMCk7XG4gICAgfTtcblxuICAgIHJldHVybiBEaXNwbGFjZW1lbnRNYXA7XG59KSgpO1xuXG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IERpc3BsYWNlbWVudE1hcDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07Il19
