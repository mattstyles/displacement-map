(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lib = require('../lib');

var _lib2 = _interopRequireDefault(_lib);

var WIDTH = 5;
var HEIGHT = 5;
var CELL_SIZE = 100;

var map = new _lib2['default']({
    width: WIDTH,
    height: HEIGHT
});

window.map = map;

var canvas = document.createElement('canvas');
canvas.classList.add('Surface', 'js-surface');
canvas.setAttribute('width', WIDTH * CELL_SIZE);
canvas.setAttribute('height', HEIGHT * CELL_SIZE);

var ctx = canvas.getContext('2d');

function lerp(value) {
    return 'rgba( 255, 255, 255, ' + value / 255 + ' )';
}

for (var x = 0; x < WIDTH; x++) {
    for (var y = 0; y < HEIGHT; y++) {
        ctx.fillStyle = lerp(map.get(x, y));
        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
    }
}

document.body.appendChild(canvas);

},{"../lib":2}],2:[function(require,module,exports){
"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var DisplacementMap = (function () {
    function DisplacementMap(opts) {
        var _this = this;

        _classCallCheck(this, DisplacementMap);

        this.generateSquare = function (x, y, size) {
            var mid = size / 2;
            var avg = _this.getAvgCorner(x, y, x + size, y + size);
            _this.set(x + mid, y + mid, avg);
        };

        this.generateDiamond = function (x, y, size) {
            var mid = size / 2;

            var setCell = (function (xx, yy) {
                this.set(xx, yy, this.getAvgPoint(xx, yy));
            }).bind(_this);

            setCell(x + mid, y);
            setCell(x + mid, y + size);
            setCell(x, y + mid);
            setCell(x + size, y + mid);
        };

        var options = opts || {};

        // Assign defaults or use opts
        // @TODO check power of 2 + 1 values
        this.width = options.width || 65;
        this.height = options.height || 65;

        this.buffer = new ArrayBuffer(this.width * this.height);
        this.array = new Uint8Array(this.buffer);

        // Seed corners
        this.array[this.to1d(0, 0)] = 255;
        this.array[this.to1d(0, this.height - 1)] = 255;
        this.array[this.to1d(this.width - 1, 0)] = 255;
        this.array[this.to1d(this.width - 1, this.height - 1)] = 127.5;

        this.generate(1);

        console.log(this.array);
    }

    DisplacementMap.prototype.get = function get(x, y) {
        return this.array[this.to1d(this.wrap(x), this.wrap(y))];
    };

    DisplacementMap.prototype.set = function set(x, y, value) {
        this.array[this.to1d(this.wrap(x), this.wrap(y))] = this.clamp(value);
    };

    /*-----------------------------------------------------------*
     *
     *  Generation methods
     *
     *-----------------------------------------------------------*/

    DisplacementMap.prototype.getAvg = function getAvg() {
        return Array.prototype.reduce.call(arguments, function (prev, num) {
            return prev + num;
        }) / arguments.length;
    };

    /**
     * Grabs the average of each edge point
     */

    DisplacementMap.prototype.getAvgEdge = function getAvgEdge(x1, y1, x2, y2) {
        var size = ~ ~(x2 - x1) / 2;
        return this.getAvg(this.get(x1 + size, y1), this.get(x1, y1 + size), this.get(x2, y1 + size), this.get(x1 + size, y2));
    };

    /**
     * Grabs the average from each corner point
     */

    DisplacementMap.prototype.getAvgCorner = function getAvgCorner(x1, y1, x2, y2) {
        return this.getAvg(this.get(x1, y1), this.get(x2, y1), this.get(x1, y2), this.get(x2, y2));
    };

    /**
     * Get average from a central point
     */

    DisplacementMap.prototype.getAvgPoint = function getAvgPoint(x, y, size) {
        return this.getAvg(this.get(x - size, y - size), this.get(x + size, y - size), this.get(x - size, y + size), this.get(x + size, y + size));
    };

    /**
     * @param cb <function> iterator to call
     * @param step <float> 0...1
     */

    DisplacementMap.prototype.iterate = function iterate(cb, step) {
        var size = (this.width - 1) * step;
        for (var x = 0; x < this.width - 1; x += size) {
            for (var y = 0; y < this.height - 1; y += size) {
                cb(x, y, size);
            }
        }
    };

    DisplacementMap.prototype.generate = function generate(step) {
        var dist = (this.width - 1) * step;

        //  this.iterate( function( x1, y1, x2, y2 ) {
        //      console.log( x1, y1, x2, y2 )
        //      this.set( x1, y1, 127 )
        //  }.bind( this ), step )
        this.iterate(this.generateSquare, step);
        this.iterate(this.generateDiamond, step);

        if (dist > 2) {
            this.generate(step / 2);
        }
    };

    /*-----------------------------------------------------------*
     *
     *  Helpers
     *
     *-----------------------------------------------------------*/

    /**
     * Converts from 2d to 1d
     */

    DisplacementMap.prototype.to1d = function to1d(x, y) {
        return y * this.width + x;
    };

    /**
     * Wraps 0...255 i.e. 257 becomes 1 (because 0 is important)
     */

    DisplacementMap.prototype.wrap = function wrap(value) {
        return value & 255;
    };

    /**
     * Clamps to 0...255
     */

    DisplacementMap.prototype.clamp = function clamp(value) {
        return Math.max(Math.min(value, 255), 0);
    };

    return DisplacementMap;
})();

exports["default"] = DisplacementMap;
module.exports = exports["default"];

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvbWF0dHN0eWxlcy9wcm9qZWN0cy9wcm9jZWR1cmFsL2Rpc3BsYWNlbWVudC1tYXAvZXhhbXBsZXMvc3JjLmpzIiwiL1VzZXJzL21hdHRzdHlsZXMvcHJvamVjdHMvcHJvY2VkdXJhbC9kaXNwbGFjZW1lbnQtbWFwL2xpYi9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7bUJDQ2dCLFFBQVE7Ozs7QUFFeEIsSUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFBO0FBQ2YsSUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFBO0FBQ2hCLElBQU0sU0FBUyxHQUFHLEdBQUcsQ0FBQTs7QUFFckIsSUFBSSxHQUFHLEdBQUcscUJBQVE7QUFDZCxTQUFLLEVBQUUsS0FBSztBQUNaLFVBQU0sRUFBRSxNQUFNO0NBQ2pCLENBQUMsQ0FBQTs7QUFFRixNQUFNLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQTs7QUFFaEIsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBRSxRQUFRLENBQUUsQ0FBQTtBQUMvQyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBRSxTQUFTLEVBQUUsWUFBWSxDQUFFLENBQUE7QUFDL0MsTUFBTSxDQUFDLFlBQVksQ0FBRSxPQUFPLEVBQUUsS0FBSyxHQUFHLFNBQVMsQ0FBRSxDQUFBO0FBQ2pELE1BQU0sQ0FBQyxZQUFZLENBQUUsUUFBUSxFQUFFLE1BQU0sR0FBRyxTQUFTLENBQUUsQ0FBQTs7QUFFbkQsSUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBRSxJQUFJLENBQUUsQ0FBQTs7QUFFbkMsU0FBUyxJQUFJLENBQUUsS0FBSyxFQUFHO0FBQ25CLFdBQU8sdUJBQXVCLEdBQUssS0FBSyxHQUFHLEdBQUksQUFBRSxHQUFHLElBQUksQ0FBQTtDQUMzRDs7QUFHRCxLQUFNLElBQUks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RyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7OztBQUd6QyxZQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO0FBQ2xDLFlBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztBQUNoRCxZQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7QUFDL0MsWUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7O0FBRS9ELFlBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7O0FBRWpCLGVBQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQzNCOztBQUVELG1CQUFlLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxTQUFTLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQy9DLGVBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDNUQsQ0FBQzs7QUFFRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsU0FBUyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUU7QUFDdEQsWUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUN6RSxDQUFDOzs7Ozs7OztBQVFGLG1CQUFlLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxTQUFTLE1BQU0sR0FBRztBQUNqRCxlQUFPLEtBQUssQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxJQUFJLEVBQUUsR0FBRyxFQUFFO0FBQy9ELG1CQUFPLElBQUksR0FBRyxHQUFHLENBQUM7U0FDckIsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7S0FDekIsQ0FBQzs7Ozs7O0FBTUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsVUFBVSxHQUFHLFNBQVMsVUFBVSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtBQUN2RSxZQUFJLElBQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQSxBQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzVCLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUMxSCxDQUFDOzs7Ozs7QUFNRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsU0FBUyxZQUFZLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO0FBQzNFLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzlGLENBQUM7Ozs7OztBQU1GLG1CQUFlLENBQUMsU0FBUyxDQUFDLFdBQVcsR0FBRyxTQUFTLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtBQUNyRSxlQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0tBQzlJLENBQUM7Ozs7Ozs7QUFPRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsU0FBUyxPQUFPLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRTtBQUMzRCxZQUFJLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFBLEdBQUksSUFBSSxDQUFDO0FBQ25DLGFBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksSUFBSSxFQUFFO0FBQzNDLGlCQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRTtBQUM1QyxrQkFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7YUFDbEI7U0FDSjtLQUNKLENBQUM7O0FBRUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLFNBQVMsUUFBUSxDQUFDLElBQUksRUFBRTtBQUN6RCxZQUFJLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFBLEdBQUksSUFBSSxDQUFDOzs7Ozs7QUFNbkMsWUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3hDLFlBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxJQUFJLENBQUMsQ0FBQzs7QUFFekMsWUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO0FBQ1YsZ0JBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQzNCO0tBQ0osQ0FBQzs7Ozs7Ozs7Ozs7O0FBWUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUU7QUFDakQsZUFBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7S0FDN0IsQ0FBQzs7Ozs7O0FBTUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsSUFBSSxDQUFDLEtBQUssRUFBRTtBQUNsRCxlQUFPLEtBQUssR0FBRyxHQUFHLENBQUM7S0FDdEIsQ0FBQzs7Ozs7O0FBTUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsS0FBSyxHQUFHLFNBQVMsS0FBSyxDQUFDLEtBQUssRUFBRTtBQUNwRCxlQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDNUMsQ0FBQzs7QUFFRixXQUFPLGVBQWUsQ0FBQztDQUMxQixDQUFBLEVBQUcsQ0FBQzs7QUFFTCxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsZUFBZSxDQUFDO0FBQ3JDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxuaW1wb3J0IE1hcCBmcm9tICcuLi9saWInXG5cbmNvbnN0IFdJRFRIID0gNVxuY29uc3QgSEVJR0hUID0gNVxuY29uc3QgQ0VMTF9TSVpFID0gMTAwXG5cbmxldCBtYXAgPSBuZXcgTWFwKHtcbiAgICB3aWR0aDogV0lEVEgsXG4gICAgaGVpZ2h0OiBIRUlHSFRcbn0pXG5cbndpbmRvdy5tYXAgPSBtYXBcblxubGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdjYW52YXMnIClcbmNhbnZhcy5jbGFzc0xpc3QuYWRkKCAnU3VyZmFjZScsICdqcy1zdXJmYWNlJyApXG5jYW52YXMuc2V0QXR0cmlidXRlKCAnd2lkdGgnLCBXSURUSCAqIENFTExfU0laRSApXG5jYW52YXMuc2V0QXR0cmlidXRlKCAnaGVpZ2h0JywgSEVJR0hUICogQ0VMTF9TSVpFIClcblxubGV0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCAnMmQnIClcblxuZnVuY3Rpb24gbGVycCggdmFsdWUgKSB7XG4gICAgcmV0dXJuICdyZ2JhKCAyNTUsIDI1NSwgMjU1LCAnICsgKCB2YWx1ZSAvIDB4ZmYgKSArICcgKSdcbn1cblxuXG5mb3IgKCBsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrICkge1xuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KysgKSB7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBsZXJwKCBtYXAuZ2V0KCB4LCB5ICkgKVxuICAgICAgICBjdHguZmlsbFJlY3QoIHggKiBDRUxMX1NJWkUsIHkgKiBDRUxMX1NJWkUsIENFTExfU0laRSwgQ0VMTF9TSVpFIClcbiAgICB9XG59XG5cblxuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggY2FudmFzIClcbiIsIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG52YXIgRGlzcGxhY2VtZW50TWFwID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXNwbGFjZW1lbnRNYXAob3B0cykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEaXNwbGFjZW1lbnRNYXApO1xuXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVTcXVhcmUgPSBmdW5jdGlvbiAoeCwgeSwgc2l6ZSkge1xuICAgICAgICAgICAgdmFyIG1pZCA9IHNpemUgLyAyO1xuICAgICAgICAgICAgdmFyIGF2ZyA9IF90aGlzLmdldEF2Z0Nvcm5lcih4LCB5LCB4ICsgc2l6ZSwgeSArIHNpemUpO1xuICAgICAgICAgICAgX3RoaXMuc2V0KHggKyBtaWQsIHkgKyBtaWQsIGF2Zyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5nZW5lcmF0ZURpYW1vbmQgPSBmdW5jdGlvbiAoeCwgeSwgc2l6ZSkge1xuICAgICAgICAgICAgdmFyIG1pZCA9IHNpemUgLyAyO1xuXG4gICAgICAgICAgICB2YXIgc2V0Q2VsbCA9IChmdW5jdGlvbiAoeHgsIHl5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXQoeHgsIHl5LCB0aGlzLmdldEF2Z1BvaW50KHh4LCB5eSkpO1xuICAgICAgICAgICAgfSkuYmluZChfdGhpcyk7XG5cbiAgICAgICAgICAgIHNldENlbGwoeCArIG1pZCwgeSk7XG4gICAgICAgICAgICBzZXRDZWxsKHggKyBtaWQsIHkgKyBzaXplKTtcbiAgICAgICAgICAgIHNldENlbGwoeCwgeSArIG1pZCk7XG4gICAgICAgICAgICBzZXRDZWxsKHggKyBzaXplLCB5ICsgbWlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb3B0aW9ucyA9IG9wdHMgfHwge307XG5cbiAgICAgICAgLy8gQXNzaWduIGRlZmF1bHRzIG9yIHVzZSBvcHRzXG4gICAgICAgIC8vIEBUT0RPIGNoZWNrIHBvd2VyIG9mIDIgKyAxIHZhbHVlc1xuICAgICAgICB0aGlzLndpZHRoID0gb3B0aW9ucy53aWR0aCB8fCA2NTtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCA2NTtcblxuICAgICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcih0aGlzLndpZHRoICogdGhpcy5oZWlnaHQpO1xuICAgICAgICB0aGlzLmFycmF5ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIpO1xuXG4gICAgICAgIC8vIFNlZWQgY29ybmVyc1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCgwLCAwKV0gPSAyNTU7XG4gICAgICAgIHRoaXMuYXJyYXlbdGhpcy50bzFkKDAsIHRoaXMuaGVpZ2h0IC0gMSldID0gMjU1O1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndpZHRoIC0gMSwgMCldID0gMjU1O1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndpZHRoIC0gMSwgdGhpcy5oZWlnaHQgLSAxKV0gPSAxMjcuNTtcblxuICAgICAgICB0aGlzLmdlbmVyYXRlKDEpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuYXJyYXkpO1xuICAgIH1cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gZ2V0KHgsIHkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXJyYXlbdGhpcy50bzFkKHRoaXMud3JhcCh4KSwgdGhpcy53cmFwKHkpKV07XG4gICAgfTtcblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gc2V0KHgsIHksIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuYXJyYXlbdGhpcy50bzFkKHRoaXMud3JhcCh4KSwgdGhpcy53cmFwKHkpKV0gPSB0aGlzLmNsYW1wKHZhbHVlKTtcbiAgICB9O1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSpcbiAgICAgKlxuICAgICAqICBHZW5lcmF0aW9uIG1ldGhvZHNcbiAgICAgKlxuICAgICAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZXRBdmcgPSBmdW5jdGlvbiBnZXRBdmcoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUucmVkdWNlLmNhbGwoYXJndW1lbnRzLCBmdW5jdGlvbiAocHJldiwgbnVtKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJldiArIG51bTtcbiAgICAgICAgfSkgLyBhcmd1bWVudHMubGVuZ3RoO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBvZiBlYWNoIGVkZ2UgcG9pbnRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0QXZnRWRnZSA9IGZ1bmN0aW9uIGdldEF2Z0VkZ2UoeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgdmFyIHNpemUgPSB+IH4oeDIgLSB4MSkgLyAyO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEgKyBzaXplLCB5MSksIHRoaXMuZ2V0KHgxLCB5MSArIHNpemUpLCB0aGlzLmdldCh4MiwgeTEgKyBzaXplKSwgdGhpcy5nZXQoeDEgKyBzaXplLCB5MikpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBmcm9tIGVhY2ggY29ybmVyIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z0Nvcm5lciA9IGZ1bmN0aW9uIGdldEF2Z0Nvcm5lcih4MSwgeTEsIHgyLCB5Mikge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEsIHkxKSwgdGhpcy5nZXQoeDIsIHkxKSwgdGhpcy5nZXQoeDEsIHkyKSwgdGhpcy5nZXQoeDIsIHkyKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldCBhdmVyYWdlIGZyb20gYSBjZW50cmFsIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z1BvaW50ID0gZnVuY3Rpb24gZ2V0QXZnUG9pbnQoeCwgeSwgc2l6ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeCAtIHNpemUsIHkgLSBzaXplKSwgdGhpcy5nZXQoeCArIHNpemUsIHkgLSBzaXplKSwgdGhpcy5nZXQoeCAtIHNpemUsIHkgKyBzaXplKSwgdGhpcy5nZXQoeCArIHNpemUsIHkgKyBzaXplKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBjYiA8ZnVuY3Rpb24+IGl0ZXJhdG9yIHRvIGNhbGxcbiAgICAgKiBAcGFyYW0gc3RlcCA8ZmxvYXQ+IDAuLi4xXG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLml0ZXJhdGUgPSBmdW5jdGlvbiBpdGVyYXRlKGNiLCBzdGVwKSB7XG4gICAgICAgIHZhciBzaXplID0gKHRoaXMud2lkdGggLSAxKSAqIHN0ZXA7XG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aCAtIDE7IHggKz0gc2l6ZSkge1xuICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodCAtIDE7IHkgKz0gc2l6ZSkge1xuICAgICAgICAgICAgICAgIGNiKHgsIHksIHNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZShzdGVwKSB7XG4gICAgICAgIHZhciBkaXN0ID0gKHRoaXMud2lkdGggLSAxKSAqIHN0ZXA7XG5cbiAgICAgICAgLy8gIHRoaXMuaXRlcmF0ZSggZnVuY3Rpb24oIHgxLCB5MSwgeDIsIHkyICkge1xuICAgICAgICAvLyAgICAgIGNvbnNvbGUubG9nKCB4MSwgeTEsIHgyLCB5MiApXG4gICAgICAgIC8vICAgICAgdGhpcy5zZXQoIHgxLCB5MSwgMTI3IClcbiAgICAgICAgLy8gIH0uYmluZCggdGhpcyApLCBzdGVwIClcbiAgICAgICAgdGhpcy5pdGVyYXRlKHRoaXMuZ2VuZXJhdGVTcXVhcmUsIHN0ZXApO1xuICAgICAgICB0aGlzLml0ZXJhdGUodGhpcy5nZW5lcmF0ZURpYW1vbmQsIHN0ZXApO1xuXG4gICAgICAgIGlmIChkaXN0ID4gMikge1xuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZShzdGVwIC8gMik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSpcbiAgICAgKlxuICAgICAqICBIZWxwZXJzXG4gICAgICpcbiAgICAgKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGZyb20gMmQgdG8gMWRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUudG8xZCA9IGZ1bmN0aW9uIHRvMWQoeCwgeSkge1xuICAgICAgICByZXR1cm4geSAqIHRoaXMud2lkdGggKyB4O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBXcmFwcyAwLi4uMjU1IGkuZS4gMjU3IGJlY29tZXMgMSAoYmVjYXVzZSAwIGlzIGltcG9ydGFudClcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUud3JhcCA9IGZ1bmN0aW9uIHdyYXAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlICYgMjU1O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDbGFtcHMgdG8gMC4uLjI1NVxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5jbGFtcCA9IGZ1bmN0aW9uIGNsYW1wKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heChNYXRoLm1pbih2YWx1ZSwgMjU1KSwgMCk7XG4gICAgfTtcblxuICAgIHJldHVybiBEaXNwbGFjZW1lbnRNYXA7XG59KSgpO1xuXG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IERpc3BsYWNlbWVudE1hcDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07Il19
