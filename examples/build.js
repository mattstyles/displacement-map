(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lib = require('../lib');

var _lib2 = _interopRequireDefault(_lib);

var WIDTH = 65;
var HEIGHT = 65;
var CELL_SIZE = 10;

var map = new _lib2['default']({
    width: WIDTH,
    height: HEIGHT
});

// Seed corners to half-weight
map.seed([{ x: 0, y: 0, value: 128 }, { x: WIDTH - 1, y: 0, value: 128 }, { x: 0, y: HEIGHT - 1, value: 128 }, { x: WIDTH - 1, y: HEIGHT - 1, value: 128 }]);

var canvas = document.createElement('canvas');
canvas.classList.add('Surface', 'js-surface');
canvas.setAttribute('width', WIDTH * CELL_SIZE);
canvas.setAttribute('height', HEIGHT * CELL_SIZE);

var ctx = canvas.getContext('2d');

function lerp(value) {
    return 'rgba( 255, 255, 255, ' + value / 255 + ' )';
}

function render() {
    for (var x = 1; x < WIDTH - 1; x++) {
        for (var y = 1; y < HEIGHT - 1; y++) {
            ctx.fillStyle = lerp(map.get(x, y));
            ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
        }
    }
}

function generate() {
    var start = window.performance.now();
    map.generate();
    var time = window.performance.now() - start;
    console.log('generation time', time.toFixed(2), 'ms');
}

generate();
render();

document.body.appendChild(canvas);

window.render = render;
window.map = map;
window.generate = generate;

},{"../lib":2}],2:[function(require,module,exports){
"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var DisplacementMap = (function () {
    function DisplacementMap(opts) {
        var _this = this;

        _classCallCheck(this, DisplacementMap);

        this.generateSquare = function (x, y, size) {
            var mid = size / 2;
            var avg = _this.getAvgCorner(x, y, x + size, y + size);
            _this.set(x + mid, y + mid, avg + _this.getMidpointDisplacement(size));
        };

        this.generateDiamond = function (x, y, size) {
            var mid = size / 2;

            var setCell = (function (xx, yy) {
                var avg = this.getAvgPoint(xx, yy, mid);
                //console.log( 'setting diamond point', xx, yy, avg, 'for', x, y, size )
                this.set(xx, yy, avg + this.getMidpointDisplacement(size));
            }).bind(_this);

            setCell(x + mid, y);
            setCell(x + mid, y + size);
            setCell(x, y + mid);
            setCell(x + size, y + mid);
        };

        var options = opts || {};

        // Assign defaults or use opts
        // @TODO check power of 2 + 1 values
        this.width = options.width || 65;
        this.height = options.height || 65;

        this.smoothness = 1;

        this.buffer = new ArrayBuffer(this.width * this.height);
        this.array = new Uint8Array(this.buffer);
    }

    /**
     * Enters a list of values into the array
     * @param seeds <Array:Objects> seeds should contain x, y and value params
     */

    DisplacementMap.prototype.seed = function seed(seeds) {
        var _this2 = this;

        //@TODO check valid seed objects
        seeds.forEach(function (seed) {
            _this2.array[_this2.to1d(seed.x, seed.y)] = seed.value;
        });
    };

    /**
     * Grabs a value from the array
     * @param x <number> x coord
     * @param y <number> y coord
     */

    DisplacementMap.prototype.get = function get(x, y) {
        return this.array[this.to1d(this.wrap(x), this.wrap(y))];
    };

    /**
     * Sets a value within the array
     * @param x <number> x coord
     * @param y <number> y coord
     * @param value <number> to set
     */

    DisplacementMap.prototype.set = function set(x, y, value) {
        this.array[this.to1d(this.wrap(x), this.wrap(y))] = this.clamp255(value);
    };

    /*-----------------------------------------------------------*
     *
     *  Generation methods
     *
     *-----------------------------------------------------------*/

    /**
     * Total variance * smoothness * step
     * Step decreases with each fold to produce a better result
     */

    DisplacementMap.prototype.getMidpointDisplacement = function getMidpointDisplacement(size) {
        return this.variance() * this.smoothness * (size / (this.width - 1));
    };

    /**
     * Averages (mean) all values passed as args
     */

    DisplacementMap.prototype.getAvg = function getAvg() {
        return Array.prototype.reduce.call(arguments, function (prev, num) {
            return prev + num;
        }) / arguments.length;
    };

    /**
     * Grabs the average of each edge point
     */

    DisplacementMap.prototype.getAvgEdge = function getAvgEdge(x1, y1, x2, y2) {
        var size = ~ ~(x2 - x1) / 2;
        return this.getAvg(this.get(x1 + size, y1), this.get(x1, y1 + size), this.get(x2, y1 + size), this.get(x1 + size, y2));
    };

    /**
     * Grabs the average from each corner point
     */

    DisplacementMap.prototype.getAvgCorner = function getAvgCorner(x1, y1, x2, y2) {
        return this.getAvg(this.get(x1, y1), this.get(x2, y1), this.get(x1, y2), this.get(x2, y2));
    };

    /**
     * Get average from a central point
     */

    DisplacementMap.prototype.getAvgPoint = function getAvgPoint(x, y, size) {
        return this.getAvg(this.get(x, y - size), this.get(x + size, y), this.get(x - size, y), this.get(x, y + size));
    };

    /**
     * @param cb <function> iterator to call
     * @param step <float> 0...1
     */

    DisplacementMap.prototype.iterate = function iterate(cb, step) {
        var size = (this.width - 1) * step;
        for (var x = 0; x < this.width - 1; x += size) {
            for (var y = 0; y < this.height - 1; y += size) {
                cb(x, y, size);
            }
        }
    };

    /**
     * Starts the generation
     * @param step <float:optional> the step value or 1
     */

    DisplacementMap.prototype.generate = function generate(step) {
        if (!step) {
            step = 1;
        }
        var dist = (this.width - 1) * step;

        this.iterate(this.generateSquare, step);
        this.iterate(this.generateDiamond, step);

        if (dist > 2) {
            this.generate(step / 2);
        }
    };

    /*-----------------------------------------------------------*
     *
     *  Helpers
     *
     *-----------------------------------------------------------*/

    /**
     * Converts from 2d to 1d
     */

    DisplacementMap.prototype.to1d = function to1d(x, y) {
        return y * this.width + x;
    };

    /**
     * Wraps 0...255 i.e. 257 becomes 1 (because 0 is important)
     */

    DisplacementMap.prototype.wrap255 = function wrap255(value) {
        return value & 255;
    };

    /**
     * Wraps 0...this.width - 1
     */

    DisplacementMap.prototype.wrap = function wrap(num) {
        var min = 0;
        var max = this.width - 1;

        if (num > max) {
            return num % max;
        }

        if (num < min) {
            return max - (min - num) % (max - min);
        }

        return num;
    };

    /**
     * Clamps to 0...255
     */

    DisplacementMap.prototype.clamp255 = function clamp255(value) {
        return Math.max(Math.min(value, 255), 0);
    };

    /**
     * Clamps 0....this.width - 1
     */

    DisplacementMap.prototype.clamp = function clamp(value) {
        return Math.max(Math.min(value, this.width - 1), 0);
    };

    /**
     * Returns +-127
     */

    DisplacementMap.prototype.variance = function variance() {
        return -128 + Math.random() * 255;
    };

    return DisplacementMap;
})();

exports["default"] = DisplacementMap;
module.exports = exports["default"];

/**
 * Performs the square step - generating a point in the center
 * @param x <number> x component of top-left corner
 * @param y <number> y component of top-left corner
 * @param size <number> size of square to calculate mid-point of
 */

/**
 * Performs the diamond step - generating points at the edges
 * @param x <number> x component of top-left corner
 * @param y <number> y component of top-left corner
 * @param size <number> size of square to calculate edges of
 */

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvbWF0dHN0eWxlcy9wcm9qZWN0cy9teXByb2plY3RzL3Byb2NlZHVyYWwvZGlzcGxhY2VtZW50LW1hcC9leGFtcGxlcy9zcmMuanMiLCIvVXNlcnMvbWF0dHN0eWxlcy9wcm9qZWN0cy9teXByb2plY3RzL3Byb2NlZHVyYWwvZGlzcGxhY2VtZW50LW1hcC9saWIvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O21CQ0NnQixRQUFROzs7O0FBRXhCLElBQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQTtBQUNoQixJQUFNLE1BQU0sR0FBRyxFQUFFLENBQUE7QUFDakIsSUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFBOztBQUVwQixJQUFJLEdBQUcsR0FBRyxxQkFBUTtBQUNkLFNBQUssRUFBRSxLQUFLO0FBQ1osVUFBTSxFQUFFLE1BQU07Q0FDakIsQ0FBQyxDQUFBOzs7QUFHRixHQUFHLENBQUMsSUFBSSxDQUFDLENBQ0wsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLEdBQUksRUFBRSxFQUMzQixFQUFFLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLEdBQUksRUFBRSxFQUNuQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLEdBQUksRUFBRSxFQUNwQyxFQUFFLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFJLEVBQUUsQ0FDL0MsQ0FBQyxDQUFBOztBQUVGLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUUsUUFBUSxDQUFFLENBQUE7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LEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO0FBQzNFLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzlGLENBQUM7Ozs7OztBQU1GLG1CQUFlLENBQUMsU0FBUyxDQUFDLFdBQVcsR0FBRyxTQUFTLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtBQUNyRSxlQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7S0FDbEgsQ0FBQzs7Ozs7OztBQU9GLG1CQUFlLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxTQUFTLE9BQU8sQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFO0FBQzNELFlBQUksSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUEsR0FBSSxJQUFJLENBQUM7QUFDbkMsYUFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxJQUFJLEVBQUU7QUFDM0MsaUJBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksSUFBSSxFQUFFO0FBQzVDLGtCQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQzthQUNsQjtTQUNKO0tBQ0osQ0FBQzs7Ozs7OztBQU9GLG1CQUFlLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxTQUFTLFFBQVEsQ0FBQyxJQUFJLEVBQUU7QUFDekQsWUFBSSxDQUFDLElBQUksRUFBRTtBQUNQLGdCQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ1o7QUFDRCxZQUFJLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFBLEdBQUksSUFBSSxDQUFDOztBQUVuQyxZQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDeEMsWUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFDOztBQUV6QyxZQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7QUFDVixnQkFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDM0I7S0FDSixDQUFDOzs7Ozs7Ozs7Ozs7QUFZRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsU0FBUyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRTtBQUNqRCxlQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztLQUM3QixDQUFDOzs7Ozs7QUFNRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsU0FBUyxPQUFPLENBQUMsS0FBSyxFQUFFO0FBQ3hELGVBQU8sS0FBSyxHQUFHLEdBQUcsQ0FBQztLQUN0QixDQUFDOzs7Ozs7QUFNRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsU0FBUyxJQUFJLENBQUMsR0FBRyxFQUFFO0FBQ2hELFlBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNaLFlBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDOztBQUV6QixZQUFJLEdBQUcsR0FBRyxHQUFHLEVBQUU7QUFDWCxtQkFBTyxHQUFHLEdBQUcsR0FBRyxDQUFDO1NBQ3BCOztBQUVELFlBQUksR0FBRyxHQUFHLEdBQUcsRUFBRTtBQUNYLG1CQUFPLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUEsSUFBSyxHQUFHLEdBQUcsR0FBRyxDQUFBLEFBQUMsQ0FBQztTQUMxQzs7QUFFRCxlQUFPLEdBQUcsQ0FBQztLQUNkLENBQUM7Ozs7OztBQU1GLG1CQUFlLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxTQUFTLFFBQVEsQ0FBQyxLQUFLLEVBQUU7QUFDMUQsZUFBTyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzVDLENBQUM7Ozs7OztBQU1GLG1CQUFlLENBQUMsU0FBUyxDQUFDLEtBQUssR0FBRyxTQUFTLEtBQUssQ0FBQyxLQUFLLEVBQUU7QUFDcEQsZUFBTyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDdkQsQ0FBQzs7Ozs7O0FBTUYsbUJBQWUsQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLFNBQVMsUUFBUSxHQUFHO0FBQ3JELGVBQU8sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQztLQUNyQyxDQUFDOztBQUVGLFdBQU8sZUFBZSxDQUFDO0NBQzFCLENBQUEsRUFBRyxDQUFDOztBQUVMLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxlQUFlLENBQUM7QUFDckMsTUFBTSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG5pbXBvcnQgTWFwIGZyb20gJy4uL2xpYidcblxuY29uc3QgV0lEVEggPSA2NVxuY29uc3QgSEVJR0hUID0gNjVcbmNvbnN0IENFTExfU0laRSA9IDEwXG5cbmxldCBtYXAgPSBuZXcgTWFwKHtcbiAgICB3aWR0aDogV0lEVEgsXG4gICAgaGVpZ2h0OiBIRUlHSFRcbn0pXG5cbi8vIFNlZWQgY29ybmVycyB0byBoYWxmLXdlaWdodFxubWFwLnNlZWQoW1xuICAgIHsgeDogMCwgeTogMCwgdmFsdWU6IDB4ODAgfSxcbiAgICB7IHg6IFdJRFRIIC0gMSwgeTogMCwgdmFsdWU6IDB4ODAgfSxcbiAgICB7IHg6IDAsIHk6IEhFSUdIVCAtIDEsIHZhbHVlOiAweDgwIH0sXG4gICAgeyB4OiBXSURUSCAtIDEsIHk6IEhFSUdIVCAtIDEsIHZhbHVlOiAweDgwIH1cbl0pXG5cbmxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnY2FudmFzJyApXG5jYW52YXMuY2xhc3NMaXN0LmFkZCggJ1N1cmZhY2UnLCAnanMtc3VyZmFjZScgKVxuY2FudmFzLnNldEF0dHJpYnV0ZSggJ3dpZHRoJywgV0lEVEggKiBDRUxMX1NJWkUgKVxuY2FudmFzLnNldEF0dHJpYnV0ZSggJ2hlaWdodCcsIEhFSUdIVCAqIENFTExfU0laRSApXG5cbmxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApXG5cbmZ1bmN0aW9uIGxlcnAoIHZhbHVlICkge1xuICAgIHJldHVybiAncmdiYSggMjU1LCAyNTUsIDI1NSwgJyArICggdmFsdWUgLyAweGZmICkgKyAnICknXG59XG5cbmZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICBmb3IgKCBsZXQgeCA9IDE7IHggPCBXSURUSCAtIDE7IHgrKyApIHtcbiAgICAgICAgZm9yIChsZXQgeSA9IDE7IHkgPCBIRUlHSFQgLSAxOyB5KysgKSB7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gbGVycCggbWFwLmdldCggeCwgeSApIClcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCggeCAqIENFTExfU0laRSwgeSAqIENFTExfU0laRSwgQ0VMTF9TSVpFLCBDRUxMX1NJWkUgKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZSgpIHtcbiAgICBsZXQgc3RhcnQgPSB3aW5kb3cucGVyZm9ybWFuY2Uubm93KClcbiAgICBtYXAuZ2VuZXJhdGUoKVxuICAgIGxldCB0aW1lID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRcbiAgICBjb25zb2xlLmxvZyggJ2dlbmVyYXRpb24gdGltZScsIHRpbWUudG9GaXhlZCggMiApLCAnbXMnIClcbn1cblxuXG5nZW5lcmF0ZSgpXG5yZW5kZXIoKVxuXG5cbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIGNhbnZhcyApXG5cblxud2luZG93LnJlbmRlciA9IHJlbmRlclxud2luZG93Lm1hcCA9IG1hcFxud2luZG93LmdlbmVyYXRlID0gZ2VuZXJhdGVcbiIsIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXG52YXIgRGlzcGxhY2VtZW50TWFwID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXNwbGFjZW1lbnRNYXAob3B0cykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEaXNwbGFjZW1lbnRNYXApO1xuXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVTcXVhcmUgPSBmdW5jdGlvbiAoeCwgeSwgc2l6ZSkge1xuICAgICAgICAgICAgdmFyIG1pZCA9IHNpemUgLyAyO1xuICAgICAgICAgICAgdmFyIGF2ZyA9IF90aGlzLmdldEF2Z0Nvcm5lcih4LCB5LCB4ICsgc2l6ZSwgeSArIHNpemUpO1xuICAgICAgICAgICAgX3RoaXMuc2V0KHggKyBtaWQsIHkgKyBtaWQsIGF2ZyArIF90aGlzLmdldE1pZHBvaW50RGlzcGxhY2VtZW50KHNpemUpKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmdlbmVyYXRlRGlhbW9uZCA9IGZ1bmN0aW9uICh4LCB5LCBzaXplKSB7XG4gICAgICAgICAgICB2YXIgbWlkID0gc2l6ZSAvIDI7XG5cbiAgICAgICAgICAgIHZhciBzZXRDZWxsID0gKGZ1bmN0aW9uICh4eCwgeXkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXZnID0gdGhpcy5nZXRBdmdQb2ludCh4eCwgeXksIG1pZCk7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyggJ3NldHRpbmcgZGlhbW9uZCBwb2ludCcsIHh4LCB5eSwgYXZnLCAnZm9yJywgeCwgeSwgc2l6ZSApXG4gICAgICAgICAgICAgICAgdGhpcy5zZXQoeHgsIHl5LCBhdmcgKyB0aGlzLmdldE1pZHBvaW50RGlzcGxhY2VtZW50KHNpemUpKTtcbiAgICAgICAgICAgIH0pLmJpbmQoX3RoaXMpO1xuXG4gICAgICAgICAgICBzZXRDZWxsKHggKyBtaWQsIHkpO1xuICAgICAgICAgICAgc2V0Q2VsbCh4ICsgbWlkLCB5ICsgc2l6ZSk7XG4gICAgICAgICAgICBzZXRDZWxsKHgsIHkgKyBtaWQpO1xuICAgICAgICAgICAgc2V0Q2VsbCh4ICsgc2l6ZSwgeSArIG1pZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG9wdGlvbnMgPSBvcHRzIHx8IHt9O1xuXG4gICAgICAgIC8vIEFzc2lnbiBkZWZhdWx0cyBvciB1c2Ugb3B0c1xuICAgICAgICAvLyBAVE9ETyBjaGVjayBwb3dlciBvZiAyICsgMSB2YWx1ZXNcbiAgICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgNjU7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNjU7XG5cbiAgICAgICAgdGhpcy5zbW9vdGhuZXNzID0gMTtcblxuICAgICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcih0aGlzLndpZHRoICogdGhpcy5oZWlnaHQpO1xuICAgICAgICB0aGlzLmFycmF5ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVudGVycyBhIGxpc3Qgb2YgdmFsdWVzIGludG8gdGhlIGFycmF5XG4gICAgICogQHBhcmFtIHNlZWRzIDxBcnJheTpPYmplY3RzPiBzZWVkcyBzaG91bGQgY29udGFpbiB4LCB5IGFuZCB2YWx1ZSBwYXJhbXNcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuc2VlZCA9IGZ1bmN0aW9uIHNlZWQoc2VlZHMpIHtcbiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICAgICAgLy9AVE9ETyBjaGVjayB2YWxpZCBzZWVkIG9iamVjdHNcbiAgICAgICAgc2VlZHMuZm9yRWFjaChmdW5jdGlvbiAoc2VlZCkge1xuICAgICAgICAgICAgX3RoaXMyLmFycmF5W190aGlzMi50bzFkKHNlZWQueCwgc2VlZC55KV0gPSBzZWVkLnZhbHVlO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogR3JhYnMgYSB2YWx1ZSBmcm9tIHRoZSBhcnJheVxuICAgICAqIEBwYXJhbSB4IDxudW1iZXI+IHggY29vcmRcbiAgICAgKiBAcGFyYW0geSA8bnVtYmVyPiB5IGNvb3JkXG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldCh4LCB5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFycmF5W3RoaXMudG8xZCh0aGlzLndyYXAoeCksIHRoaXMud3JhcCh5KSldO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTZXRzIGEgdmFsdWUgd2l0aGluIHRoZSBhcnJheVxuICAgICAqIEBwYXJhbSB4IDxudW1iZXI+IHggY29vcmRcbiAgICAgKiBAcGFyYW0geSA8bnVtYmVyPiB5IGNvb3JkXG4gICAgICogQHBhcmFtIHZhbHVlIDxudW1iZXI+IHRvIHNldFxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiBzZXQoeCwgeSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQodGhpcy53cmFwKHgpLCB0aGlzLndyYXAoeSkpXSA9IHRoaXMuY2xhbXAyNTUodmFsdWUpO1xuICAgIH07XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKlxuICAgICAqXG4gICAgICogIEdlbmVyYXRpb24gbWV0aG9kc1xuICAgICAqXG4gICAgICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBUb3RhbCB2YXJpYW5jZSAqIHNtb290aG5lc3MgKiBzdGVwXG4gICAgICogU3RlcCBkZWNyZWFzZXMgd2l0aCBlYWNoIGZvbGQgdG8gcHJvZHVjZSBhIGJldHRlciByZXN1bHRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0TWlkcG9pbnREaXNwbGFjZW1lbnQgPSBmdW5jdGlvbiBnZXRNaWRwb2ludERpc3BsYWNlbWVudChzaXplKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhcmlhbmNlKCkgKiB0aGlzLnNtb290aG5lc3MgKiAoc2l6ZSAvICh0aGlzLndpZHRoIC0gMSkpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBdmVyYWdlcyAobWVhbikgYWxsIHZhbHVlcyBwYXNzZWQgYXMgYXJnc1xuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZXRBdmcgPSBmdW5jdGlvbiBnZXRBdmcoKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUucmVkdWNlLmNhbGwoYXJndW1lbnRzLCBmdW5jdGlvbiAocHJldiwgbnVtKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJldiArIG51bTtcbiAgICAgICAgfSkgLyBhcmd1bWVudHMubGVuZ3RoO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBvZiBlYWNoIGVkZ2UgcG9pbnRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0QXZnRWRnZSA9IGZ1bmN0aW9uIGdldEF2Z0VkZ2UoeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgdmFyIHNpemUgPSB+IH4oeDIgLSB4MSkgLyAyO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEgKyBzaXplLCB5MSksIHRoaXMuZ2V0KHgxLCB5MSArIHNpemUpLCB0aGlzLmdldCh4MiwgeTEgKyBzaXplKSwgdGhpcy5nZXQoeDEgKyBzaXplLCB5MikpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHcmFicyB0aGUgYXZlcmFnZSBmcm9tIGVhY2ggY29ybmVyIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z0Nvcm5lciA9IGZ1bmN0aW9uIGdldEF2Z0Nvcm5lcih4MSwgeTEsIHgyLCB5Mikge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeDEsIHkxKSwgdGhpcy5nZXQoeDIsIHkxKSwgdGhpcy5nZXQoeDEsIHkyKSwgdGhpcy5nZXQoeDIsIHkyKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdldCBhdmVyYWdlIGZyb20gYSBjZW50cmFsIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z1BvaW50ID0gZnVuY3Rpb24gZ2V0QXZnUG9pbnQoeCwgeSwgc2l6ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBdmcodGhpcy5nZXQoeCwgeSAtIHNpemUpLCB0aGlzLmdldCh4ICsgc2l6ZSwgeSksIHRoaXMuZ2V0KHggLSBzaXplLCB5KSwgdGhpcy5nZXQoeCwgeSArIHNpemUpKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNiIDxmdW5jdGlvbj4gaXRlcmF0b3IgdG8gY2FsbFxuICAgICAqIEBwYXJhbSBzdGVwIDxmbG9hdD4gMC4uLjFcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuaXRlcmF0ZSA9IGZ1bmN0aW9uIGl0ZXJhdGUoY2IsIHN0ZXApIHtcbiAgICAgICAgdmFyIHNpemUgPSAodGhpcy53aWR0aCAtIDEpICogc3RlcDtcbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB0aGlzLndpZHRoIC0gMTsgeCArPSBzaXplKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0IC0gMTsgeSArPSBzaXplKSB7XG4gICAgICAgICAgICAgICAgY2IoeCwgeSwgc2l6ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU3RhcnRzIHRoZSBnZW5lcmF0aW9uXG4gICAgICogQHBhcmFtIHN0ZXAgPGZsb2F0Om9wdGlvbmFsPiB0aGUgc3RlcCB2YWx1ZSBvciAxXG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24gZ2VuZXJhdGUoc3RlcCkge1xuICAgICAgICBpZiAoIXN0ZXApIHtcbiAgICAgICAgICAgIHN0ZXAgPSAxO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkaXN0ID0gKHRoaXMud2lkdGggLSAxKSAqIHN0ZXA7XG5cbiAgICAgICAgdGhpcy5pdGVyYXRlKHRoaXMuZ2VuZXJhdGVTcXVhcmUsIHN0ZXApO1xuICAgICAgICB0aGlzLml0ZXJhdGUodGhpcy5nZW5lcmF0ZURpYW1vbmQsIHN0ZXApO1xuXG4gICAgICAgIGlmIChkaXN0ID4gMikge1xuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZShzdGVwIC8gMik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSpcbiAgICAgKlxuICAgICAqICBIZWxwZXJzXG4gICAgICpcbiAgICAgKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGZyb20gMmQgdG8gMWRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUudG8xZCA9IGZ1bmN0aW9uIHRvMWQoeCwgeSkge1xuICAgICAgICByZXR1cm4geSAqIHRoaXMud2lkdGggKyB4O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBXcmFwcyAwLi4uMjU1IGkuZS4gMjU3IGJlY29tZXMgMSAoYmVjYXVzZSAwIGlzIGltcG9ydGFudClcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUud3JhcDI1NSA9IGZ1bmN0aW9uIHdyYXAyNTUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlICYgMjU1O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBXcmFwcyAwLi4udGhpcy53aWR0aCAtIDFcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUud3JhcCA9IGZ1bmN0aW9uIHdyYXAobnVtKSB7XG4gICAgICAgIHZhciBtaW4gPSAwO1xuICAgICAgICB2YXIgbWF4ID0gdGhpcy53aWR0aCAtIDE7XG5cbiAgICAgICAgaWYgKG51bSA+IG1heCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bSAlIG1heDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChudW0gPCBtaW4pIHtcbiAgICAgICAgICAgIHJldHVybiBtYXggLSAobWluIC0gbnVtKSAlIChtYXggLSBtaW4pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xhbXBzIHRvIDAuLi4yNTVcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuY2xhbXAyNTUgPSBmdW5jdGlvbiBjbGFtcDI1NSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoTWF0aC5taW4odmFsdWUsIDI1NSksIDApO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDbGFtcHMgMC4uLi50aGlzLndpZHRoIC0gMVxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5jbGFtcCA9IGZ1bmN0aW9uIGNsYW1wKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heChNYXRoLm1pbih2YWx1ZSwgdGhpcy53aWR0aCAtIDEpLCAwKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyArLTEyN1xuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS52YXJpYW5jZSA9IGZ1bmN0aW9uIHZhcmlhbmNlKCkge1xuICAgICAgICByZXR1cm4gLTEyOCArIE1hdGgucmFuZG9tKCkgKiAyNTU7XG4gICAgfTtcblxuICAgIHJldHVybiBEaXNwbGFjZW1lbnRNYXA7XG59KSgpO1xuXG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IERpc3BsYWNlbWVudE1hcDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1tcImRlZmF1bHRcIl07XG5cbi8qKlxuICogUGVyZm9ybXMgdGhlIHNxdWFyZSBzdGVwIC0gZ2VuZXJhdGluZyBhIHBvaW50IGluIHRoZSBjZW50ZXJcbiAqIEBwYXJhbSB4IDxudW1iZXI+IHggY29tcG9uZW50IG9mIHRvcC1sZWZ0IGNvcm5lclxuICogQHBhcmFtIHkgPG51bWJlcj4geSBjb21wb25lbnQgb2YgdG9wLWxlZnQgY29ybmVyXG4gKiBAcGFyYW0gc2l6ZSA8bnVtYmVyPiBzaXplIG9mIHNxdWFyZSB0byBjYWxjdWxhdGUgbWlkLXBvaW50IG9mXG4gKi9cblxuLyoqXG4gKiBQZXJmb3JtcyB0aGUgZGlhbW9uZCBzdGVwIC0gZ2VuZXJhdGluZyBwb2ludHMgYXQgdGhlIGVkZ2VzXG4gKiBAcGFyYW0geCA8bnVtYmVyPiB4IGNvbXBvbmVudCBvZiB0b3AtbGVmdCBjb3JuZXJcbiAqIEBwYXJhbSB5IDxudW1iZXI+IHkgY29tcG9uZW50IG9mIHRvcC1sZWZ0IGNvcm5lclxuICogQHBhcmFtIHNpemUgPG51bWJlcj4gc2l6ZSBvZiBzcXVhcmUgdG8gY2FsY3VsYXRlIGVkZ2VzIG9mXG4gKi8iXX0=
