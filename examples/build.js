(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _lib = require('../lib');

var _lib2 = _interopRequireDefault(_lib);

var WIDTH = 257;
var HEIGHT = 257;
var CELL_SIZE = 2;

var map = new _lib2['default']({
    width: WIDTH,
    height: HEIGHT
});

window.map = map;

var canvas = document.createElement('canvas');
canvas.classList.add('Surface', 'js-surface');
canvas.setAttribute('width', WIDTH * CELL_SIZE);
canvas.setAttribute('height', HEIGHT * CELL_SIZE);

var ctx = canvas.getContext('2d');

function lerp(value) {
    return 'rgba( 255, 255, 255, ' + value / 255 + ' )';
}

for (var x = 0; x < WIDTH; x++) {
    for (var y = 0; y < HEIGHT; y++) {
        ctx.fillStyle = lerp(map.get(x, y));
        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
    }
}

document.body.appendChild(canvas);

},{"../lib":2}],2:[function(require,module,exports){
"use strict";

exports.__esModule = true;

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var DisplacementMap = (function () {
    function DisplacementMap(opts) {
        var _this = this;

        _classCallCheck(this, DisplacementMap);

        this.generateSquare = function (x, y, size) {
            var mid = size / 2;
            var avg = _this.getAvgCorner(x, y, x + size, y + size);
            _this.set(x + mid, y + mid, avg + _this.getMidpointDisplacement(size));
        };

        this.generateDiamond = function (x, y, size) {
            var mid = size / 2;

            var setCell = (function (xx, yy) {
                var avg = this.getAvgPoint(xx, yy, mid);
                //console.log( 'setting diamond point', xx, yy, avg, 'for', x, y, size )
                this.set(xx, yy, avg + this.getMidpointDisplacement(size));
            }).bind(_this);

            setCell(x + mid, y);
            setCell(x + mid, y + size);
            setCell(x, y + mid);
            setCell(x + size, y + mid);
        };

        var options = opts || {};

        // Assign defaults or use opts
        // @TODO check power of 2 + 1 values
        this.width = options.width || 65;
        this.height = options.height || 65;

        this.smoothness = 2.75;

        this.buffer = new ArrayBuffer(this.width * this.height);
        this.array = new Uint8Array(this.buffer);

        // Seed corners
        this.array[this.to1d(0, 0)] = 127;
        this.array[this.to1d(0, this.height - 1)] = 127;
        this.array[this.to1d(this.width - 1, 0)] = 127;
        this.array[this.to1d(this.width - 1, this.height - 1)] = 127;

        this.generate(1);

        console.log(this.array);
    }

    DisplacementMap.prototype.get = function get(x, y) {
        return this.array[this.to1d(this.wrap(x), this.wrap(y))];
    };

    DisplacementMap.prototype.set = function set(x, y, value) {
        this.array[this.to1d(this.wrap(x), this.wrap(y))] = this.clamp255(value);
    };

    /*-----------------------------------------------------------*
     *
     *  Generation methods
     *
     *-----------------------------------------------------------*/

    /**
     * Returns +-127
     */

    DisplacementMap.prototype.variance = function variance() {
        return -127 + Math.random() * 255;
    };

    /**
     * Total variance * smoothness * step
     * Step decreases with each fold to produce a better result
     */

    DisplacementMap.prototype.getMidpointDisplacement = function getMidpointDisplacement(size) {
        return this.variance() * this.smoothness * (size / (this.width - 1));
    };

    /**
     * Averages (mean) all values passed as args
     */

    DisplacementMap.prototype.getAvg = function getAvg() {
        return Array.prototype.reduce.call(arguments, function (prev, num) {
            return prev + num;
        }) / arguments.length;
    };

    /**
     * Grabs the average of each edge point
     */

    DisplacementMap.prototype.getAvgEdge = function getAvgEdge(x1, y1, x2, y2) {
        var size = ~ ~(x2 - x1) / 2;
        return this.getAvg(this.get(x1 + size, y1), this.get(x1, y1 + size), this.get(x2, y1 + size), this.get(x1 + size, y2));
    };

    /**
     * Grabs the average from each corner point
     */

    DisplacementMap.prototype.getAvgCorner = function getAvgCorner(x1, y1, x2, y2) {
        return this.getAvg(this.get(x1, y1), this.get(x2, y1), this.get(x1, y2), this.get(x2, y2));
    };

    /**
     * Get average from a central point
     */

    DisplacementMap.prototype.getAvgPoint = function getAvgPoint(x, y, size) {
        return this.getAvg(this.get(x, y - size), this.get(x + size, y), this.get(x - size, y), this.get(x, y + size));
    };

    /**
     * @param cb <function> iterator to call
     * @param step <float> 0...1
     */

    DisplacementMap.prototype.iterate = function iterate(cb, step) {
        var size = (this.width - 1) * step;
        for (var x = 0; x < this.width - 1; x += size) {
            for (var y = 0; y < this.height - 1; y += size) {
                cb(x, y, size);
            }
        }
    };

    DisplacementMap.prototype.generate = function generate(step) {
        var dist = (this.width - 1) * step;

        this.iterate(this.generateSquare, step);
        this.iterate(this.generateDiamond, step);

        if (dist > 2) {
            this.generate(step / 2);
        }
    };

    /*-----------------------------------------------------------*
     *
     *  Helpers
     *
     *-----------------------------------------------------------*/

    /**
     * Converts from 2d to 1d
     */

    DisplacementMap.prototype.to1d = function to1d(x, y) {
        return y * this.width + x;
    };

    /**
     * Wraps 0...255 i.e. 257 becomes 1 (because 0 is important)
     */

    DisplacementMap.prototype.wrap255 = function wrap255(value) {
        return value & 255;
    };

    /**
     * Wraps 0...this.width - 1
     */
    // wrap( value ) {
    //     return value & ( this.width - 1 )
    // }

    DisplacementMap.prototype.wrap = function wrap(num) {
        var min = 0;
        var max = this.width - 1;

        if (num > max) {
            return num % max;
        }

        if (num < min) {
            return max - (min - num) % (max - min);
        }

        return num;
    };

    /**
     * Clamps to 0...255
     */

    DisplacementMap.prototype.clamp255 = function clamp255(value) {
        return Math.max(Math.min(value, 255), 0);
    };

    /**
     * Clamps 0....this.width - 1
     */

    DisplacementMap.prototype.clamp = function clamp(value) {
        return Math.max(Math.min(value, this.width - 1), 0);
    };

    return DisplacementMap;
})();

exports["default"] = DisplacementMap;
module.exports = exports["default"];

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvbWF0dHN0eWxlcy9wcm9qZWN0cy9wcm9jZWR1cmFsL2Rpc3BsYWNlbWVudC1tYXAvZXhhbXBsZXMvc3JjLmpzIiwiL1VzZXJzL21hdHRzdHlsZXMvcHJvamVjdHMvcHJvY2VkdXJhbC9kaXNwbGFjZW1lbnQtbWFwL2xpYi9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7bUJDQ2dCLFFBQVE7Ozs7QUFFeEIsSUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFBO0FBQ2pCLElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQTtBQUNsQixJQUFNLFNBQVMsR0FBRyxDQUFDLENBQUE7O0FBRW5CLElBQUksR0FBRyxHQUFHLHFCQUFRO0FBQ2QsU0FBSyxFQUFFLEtBQUs7QUFDWixVQUFNLEVBQUUsTUFBTTtDQUNqQixDQUFDLENBQUE7O0FBRUYsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUE7O0FBRWhCLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUUsUUFBUSxDQUFFLENBQUE7QUFDL0MsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUUsU0FBUyxFQUFFLFlBQVksQ0FBRSxDQUFBO0FBQy9DLE1BQU0sQ0FBQyxZQUFZLENBQUUsT0FBTyxFQUFFLEtBQUssR0FBRyxTQUFTLENBQUUsQ0FBQTtBQUNqRCxNQUFNLENBQUMsWUFBWSxDQUFFLFFBQVEsRUFBRSxNQUFNLEdBQUcsU0FBUyxDQUFFLENBQUE7O0FBRW5ELElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUUsSUFBSSxDQUFFLENBQUE7O0FBRW5DLFNBQVMsSUFBSSxDQUFFLEtBQUssRUFBRztBQUNuQixXQUFPLHVCQUF1QixHQUFLLEtBQUssR0FBRyxHQUFJLEFBQUUsR0FBRyxJQUFJLENBQUE7Q0FDM0Q7O0FBR0QsS0FBTSxJQUFJ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RUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtBQUN2RSxZQUFJLElBQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQSxBQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzVCLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUMxSCxDQUFDOzs7Ozs7QUFNRixtQkFBZSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsU0FBUyxZQUFZLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO0FBQzNFLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQzlGLENBQUM7Ozs7OztBQU1GLG1CQUFlLENBQUMsU0FBUyxDQUFDLFdBQVcsR0FBRyxTQUFTLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtBQUNyRSxlQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElB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QUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUN2RCxDQUFDOztBQUVGLFdBQU8sZUFBZSxDQUFDO0NBQzFCLENBQUEsRUFBRyxDQUFDOztBQUVMLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxlQUFlLENBQUM7QUFDckMsTUFBTSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG5pbXBvcnQgTWFwIGZyb20gJy4uL2xpYidcblxuY29uc3QgV0lEVEggPSAyNTdcbmNvbnN0IEhFSUdIVCA9IDI1N1xuY29uc3QgQ0VMTF9TSVpFID0gMlxuXG5sZXQgbWFwID0gbmV3IE1hcCh7XG4gICAgd2lkdGg6IFdJRFRILFxuICAgIGhlaWdodDogSEVJR0hUXG59KVxuXG53aW5kb3cubWFwID0gbWFwXG5cbmxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnY2FudmFzJyApXG5jYW52YXMuY2xhc3NMaXN0LmFkZCggJ1N1cmZhY2UnLCAnanMtc3VyZmFjZScgKVxuY2FudmFzLnNldEF0dHJpYnV0ZSggJ3dpZHRoJywgV0lEVEggKiBDRUxMX1NJWkUgKVxuY2FudmFzLnNldEF0dHJpYnV0ZSggJ2hlaWdodCcsIEhFSUdIVCAqIENFTExfU0laRSApXG5cbmxldCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApXG5cbmZ1bmN0aW9uIGxlcnAoIHZhbHVlICkge1xuICAgIHJldHVybiAncmdiYSggMjU1LCAyNTUsIDI1NSwgJyArICggdmFsdWUgLyAweGZmICkgKyAnICknXG59XG5cblxuZm9yICggbGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKyApIHtcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrICkge1xuICAgICAgICBjdHguZmlsbFN0eWxlID0gbGVycCggbWFwLmdldCggeCwgeSApIClcbiAgICAgICAgY3R4LmZpbGxSZWN0KCB4ICogQ0VMTF9TSVpFLCB5ICogQ0VMTF9TSVpFLCBDRUxMX1NJWkUsIENFTExfU0laRSApXG4gICAgfVxufVxuXG5cbmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIGNhbnZhcyApXG4iLCJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxudmFyIERpc3BsYWNlbWVudE1hcCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRGlzcGxhY2VtZW50TWFwKG9wdHMpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGlzcGxhY2VtZW50TWFwKTtcblxuICAgICAgICB0aGlzLmdlbmVyYXRlU3F1YXJlID0gZnVuY3Rpb24gKHgsIHksIHNpemUpIHtcbiAgICAgICAgICAgIHZhciBtaWQgPSBzaXplIC8gMjtcbiAgICAgICAgICAgIHZhciBhdmcgPSBfdGhpcy5nZXRBdmdDb3JuZXIoeCwgeSwgeCArIHNpemUsIHkgKyBzaXplKTtcbiAgICAgICAgICAgIF90aGlzLnNldCh4ICsgbWlkLCB5ICsgbWlkLCBhdmcgKyBfdGhpcy5nZXRNaWRwb2ludERpc3BsYWNlbWVudChzaXplKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5nZW5lcmF0ZURpYW1vbmQgPSBmdW5jdGlvbiAoeCwgeSwgc2l6ZSkge1xuICAgICAgICAgICAgdmFyIG1pZCA9IHNpemUgLyAyO1xuXG4gICAgICAgICAgICB2YXIgc2V0Q2VsbCA9IChmdW5jdGlvbiAoeHgsIHl5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGF2ZyA9IHRoaXMuZ2V0QXZnUG9pbnQoeHgsIHl5LCBtaWQpO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coICdzZXR0aW5nIGRpYW1vbmQgcG9pbnQnLCB4eCwgeXksIGF2ZywgJ2ZvcicsIHgsIHksIHNpemUgKVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0KHh4LCB5eSwgYXZnICsgdGhpcy5nZXRNaWRwb2ludERpc3BsYWNlbWVudChzaXplKSk7XG4gICAgICAgICAgICB9KS5iaW5kKF90aGlzKTtcblxuICAgICAgICAgICAgc2V0Q2VsbCh4ICsgbWlkLCB5KTtcbiAgICAgICAgICAgIHNldENlbGwoeCArIG1pZCwgeSArIHNpemUpO1xuICAgICAgICAgICAgc2V0Q2VsbCh4LCB5ICsgbWlkKTtcbiAgICAgICAgICAgIHNldENlbGwoeCArIHNpemUsIHkgKyBtaWQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBvcHRpb25zID0gb3B0cyB8fCB7fTtcblxuICAgICAgICAvLyBBc3NpZ24gZGVmYXVsdHMgb3IgdXNlIG9wdHNcbiAgICAgICAgLy8gQFRPRE8gY2hlY2sgcG93ZXIgb2YgMiArIDEgdmFsdWVzXG4gICAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoIHx8IDY1O1xuICAgICAgICB0aGlzLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDY1O1xuXG4gICAgICAgIHRoaXMuc21vb3RobmVzcyA9IDIuNzU7XG5cbiAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5hcnJheSA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyKTtcblxuICAgICAgICAvLyBTZWVkIGNvcm5lcnNcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQoMCwgMCldID0gMTI3O1xuICAgICAgICB0aGlzLmFycmF5W3RoaXMudG8xZCgwLCB0aGlzLmhlaWdodCAtIDEpXSA9IDEyNztcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQodGhpcy53aWR0aCAtIDEsIDApXSA9IDEyNztcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQodGhpcy53aWR0aCAtIDEsIHRoaXMuaGVpZ2h0IC0gMSldID0gMTI3O1xuXG4gICAgICAgIHRoaXMuZ2VuZXJhdGUoMSk7XG5cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5hcnJheSk7XG4gICAgfVxuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQoeCwgeSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hcnJheVt0aGlzLnRvMWQodGhpcy53cmFwKHgpLCB0aGlzLndyYXAoeSkpXTtcbiAgICB9O1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiBzZXQoeCwgeSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5hcnJheVt0aGlzLnRvMWQodGhpcy53cmFwKHgpLCB0aGlzLndyYXAoeSkpXSA9IHRoaXMuY2xhbXAyNTUodmFsdWUpO1xuICAgIH07XG5cbiAgICAvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKlxuICAgICAqXG4gICAgICogIEdlbmVyYXRpb24gbWV0aG9kc1xuICAgICAqXG4gICAgICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zICstMTI3XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLnZhcmlhbmNlID0gZnVuY3Rpb24gdmFyaWFuY2UoKSB7XG4gICAgICAgIHJldHVybiAtMTI3ICsgTWF0aC5yYW5kb20oKSAqIDI1NTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVG90YWwgdmFyaWFuY2UgKiBzbW9vdGhuZXNzICogc3RlcFxuICAgICAqIFN0ZXAgZGVjcmVhc2VzIHdpdGggZWFjaCBmb2xkIHRvIHByb2R1Y2UgYSBiZXR0ZXIgcmVzdWx0XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldE1pZHBvaW50RGlzcGxhY2VtZW50ID0gZnVuY3Rpb24gZ2V0TWlkcG9pbnREaXNwbGFjZW1lbnQoc2l6ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy52YXJpYW5jZSgpICogdGhpcy5zbW9vdGhuZXNzICogKHNpemUgLyAodGhpcy53aWR0aCAtIDEpKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQXZlcmFnZXMgKG1lYW4pIGFsbCB2YWx1ZXMgcGFzc2VkIGFzIGFyZ3NcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2V0QXZnID0gZnVuY3Rpb24gZ2V0QXZnKCkge1xuICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnJlZHVjZS5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24gKHByZXYsIG51bSkge1xuICAgICAgICAgICAgcmV0dXJuIHByZXYgKyBudW07XG4gICAgICAgIH0pIC8gYXJndW1lbnRzLmxlbmd0aDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogR3JhYnMgdGhlIGF2ZXJhZ2Ugb2YgZWFjaCBlZGdlIHBvaW50XG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmdldEF2Z0VkZ2UgPSBmdW5jdGlvbiBnZXRBdmdFZGdlKHgxLCB5MSwgeDIsIHkyKSB7XG4gICAgICAgIHZhciBzaXplID0gfiB+KHgyIC0geDEpIC8gMjtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXZnKHRoaXMuZ2V0KHgxICsgc2l6ZSwgeTEpLCB0aGlzLmdldCh4MSwgeTEgKyBzaXplKSwgdGhpcy5nZXQoeDIsIHkxICsgc2l6ZSksIHRoaXMuZ2V0KHgxICsgc2l6ZSwgeTIpKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogR3JhYnMgdGhlIGF2ZXJhZ2UgZnJvbSBlYWNoIGNvcm5lciBwb2ludFxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZXRBdmdDb3JuZXIgPSBmdW5jdGlvbiBnZXRBdmdDb3JuZXIoeDEsIHkxLCB4MiwgeTIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXZnKHRoaXMuZ2V0KHgxLCB5MSksIHRoaXMuZ2V0KHgyLCB5MSksIHRoaXMuZ2V0KHgxLCB5MiksIHRoaXMuZ2V0KHgyLCB5MikpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYXZlcmFnZSBmcm9tIGEgY2VudHJhbCBwb2ludFxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5nZXRBdmdQb2ludCA9IGZ1bmN0aW9uIGdldEF2Z1BvaW50KHgsIHksIHNpemUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXZnKHRoaXMuZ2V0KHgsIHkgLSBzaXplKSwgdGhpcy5nZXQoeCArIHNpemUsIHkpLCB0aGlzLmdldCh4IC0gc2l6ZSwgeSksIHRoaXMuZ2V0KHgsIHkgKyBzaXplKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBjYiA8ZnVuY3Rpb24+IGl0ZXJhdG9yIHRvIGNhbGxcbiAgICAgKiBAcGFyYW0gc3RlcCA8ZmxvYXQ+IDAuLi4xXG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLml0ZXJhdGUgPSBmdW5jdGlvbiBpdGVyYXRlKGNiLCBzdGVwKSB7XG4gICAgICAgIHZhciBzaXplID0gKHRoaXMud2lkdGggLSAxKSAqIHN0ZXA7XG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aCAtIDE7IHggKz0gc2l6ZSkge1xuICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodCAtIDE7IHkgKz0gc2l6ZSkge1xuICAgICAgICAgICAgICAgIGNiKHgsIHksIHNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZShzdGVwKSB7XG4gICAgICAgIHZhciBkaXN0ID0gKHRoaXMud2lkdGggLSAxKSAqIHN0ZXA7XG5cbiAgICAgICAgdGhpcy5pdGVyYXRlKHRoaXMuZ2VuZXJhdGVTcXVhcmUsIHN0ZXApO1xuICAgICAgICB0aGlzLml0ZXJhdGUodGhpcy5nZW5lcmF0ZURpYW1vbmQsIHN0ZXApO1xuXG4gICAgICAgIGlmIChkaXN0ID4gMikge1xuICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZShzdGVwIC8gMik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSpcbiAgICAgKlxuICAgICAqICBIZWxwZXJzXG4gICAgICpcbiAgICAgKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGZyb20gMmQgdG8gMWRcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUudG8xZCA9IGZ1bmN0aW9uIHRvMWQoeCwgeSkge1xuICAgICAgICByZXR1cm4geSAqIHRoaXMud2lkdGggKyB4O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBXcmFwcyAwLi4uMjU1IGkuZS4gMjU3IGJlY29tZXMgMSAoYmVjYXVzZSAwIGlzIGltcG9ydGFudClcbiAgICAgKi9cblxuICAgIERpc3BsYWNlbWVudE1hcC5wcm90b3R5cGUud3JhcDI1NSA9IGZ1bmN0aW9uIHdyYXAyNTUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlICYgMjU1O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBXcmFwcyAwLi4udGhpcy53aWR0aCAtIDFcbiAgICAgKi9cbiAgICAvLyB3cmFwKCB2YWx1ZSApIHtcbiAgICAvLyAgICAgcmV0dXJuIHZhbHVlICYgKCB0aGlzLndpZHRoIC0gMSApXG4gICAgLy8gfVxuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS53cmFwID0gZnVuY3Rpb24gd3JhcChudW0pIHtcbiAgICAgICAgdmFyIG1pbiA9IDA7XG4gICAgICAgIHZhciBtYXggPSB0aGlzLndpZHRoIC0gMTtcblxuICAgICAgICBpZiAobnVtID4gbWF4KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVtICUgbWF4O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG51bSA8IG1pbikge1xuICAgICAgICAgICAgcmV0dXJuIG1heCAtIChtaW4gLSBudW0pICUgKG1heCAtIG1pbik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbnVtO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDbGFtcHMgdG8gMC4uLjI1NVxuICAgICAqL1xuXG4gICAgRGlzcGxhY2VtZW50TWFwLnByb3RvdHlwZS5jbGFtcDI1NSA9IGZ1bmN0aW9uIGNsYW1wMjU1KHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLm1heChNYXRoLm1pbih2YWx1ZSwgMjU1KSwgMCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENsYW1wcyAwLi4uLnRoaXMud2lkdGggLSAxXG4gICAgICovXG5cbiAgICBEaXNwbGFjZW1lbnRNYXAucHJvdG90eXBlLmNsYW1wID0gZnVuY3Rpb24gY2xhbXAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KE1hdGgubWluKHZhbHVlLCB0aGlzLndpZHRoIC0gMSksIDApO1xuICAgIH07XG5cbiAgICByZXR1cm4gRGlzcGxhY2VtZW50TWFwO1xufSkoKTtcblxuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBEaXNwbGFjZW1lbnRNYXA7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbXCJkZWZhdWx0XCJdOyJdfQ==
